import{z as Re,c,r as s,D as Ve,R as De,A as ye,H as Xe,w as me,B as Ge,C as q,E as Le,b as He,ac as Ee,Q as Ue,K as We,V as je,N as qe,o as r,a as u,i as w,L as p,j as Je,l as d,m as h,p as M,q as F,u as g,M as J,n as X,J as Ke,f as be,P as S,k as N,e as O,a2 as ke,a3 as Qe,G as B,U as K,h as I,g as Ze}from"./index-DWKgdAH2.js";import{O as et,k as tt}from"./useResponsive-CoxXLe23-CoJWR8uA.js";import{x as at}from"./Title-DyD-mBPN-Cd9Bnlgg.js";import{r as lt,a as ot}from"./usePrinter-CLcxWv-4-dA-zEbQs.js";import{C as nt}from"./Legend-BorSDXCj-BGlrHhi6.js";import{W as rt}from"./DataTable-D8fcY_sJ-B-gWso_F.js";import{E as st}from"./Tooltip-qod9o4Vz-BkuRNW4I.js";import ut from"./vue-ui-skeleton-Dgzcn3FL-QTPCyjXQ.js";import it from"./vue-ui-accordion-m8rut1bP-BfpJTYkN.js";import{c as xe}from"./useNestedProp-BxrcwmTZ-DuVaLmrv.js";import{p as vt}from"./PackageVersion-mSsg8dpu-BMuAJ9y0.js";import{S as ct}from"./PenAndPaper-Dk41ZrJ0-DIRvLwPQ.js";import{s as dt}from"./vue-data-ui-DF7u-eZV-BLQGmUKN.js";import"./Shape-DYFnvMNd-vb9KMPt_.js";const ht=["id"],gt=["xmlns","viewBox"],pt=["cx","cy","r","stroke","stroke-width","stroke-dasharray","stroke-dashoffset"],ft=["cx","cy","r","stroke","stroke-width","stroke-dasharray","stroke-dashoffset"],yt=["id"],mt=["stdDeviation"],bt=["filter"],kt=["cx","cy","r","stroke-width","stroke-dasharray","stroke-dashoffset"],xt=["cx","cy","r","stroke-width","stroke-dasharray","stroke-dashoffset","onMouseenter"],$t={key:1},wt=["onMouseenter"],Ct=["x","y","font-size","fill","font-weight"],Tt={key:5,class:"vue-data-ui-watermark"},Ot=["onClick"],It=["innerHTML"],Pt={__name:"vue-ui-onion",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectLegend"],setup($e,{expose:we,emit:Ce}){const k=$e,{vue_ui_onion:Te}=Re(),Y=c(()=>!!k.dataset&&k.dataset.length),C=s(Ve()),Oe=s(null),Q=s(0),z=s(!1),G=s(""),y=s([]),T=s(null),Z=s(null),ee=s(null),te=s(null),ae=s(null),le=s(0),oe=s(0),ne=s(0),e=c({get:()=>re(),set:a=>a});function re(){const a=xe({userConfig:k.config,defaultConfig:Te});return a.theme?{...xe({userConfig:Xe.vue_ui_onion[a.theme]||k.config,defaultConfig:a}),customPalette:De[a.theme]||ye}:a}me(()=>k.config,a=>{e.value=re(),ce(),le.value+=1,oe.value+=1,ne.value+=1},{deep:!0});const{isPrinting:se,isImaging:ue,generatePdf:ie,generateImage:ve}=lt({elementId:`vue-ui-onion_${C.value}`,fileName:e.value.style.chart.title.text||"vue-ui-onion"}),Ie=c(()=>e.value.userOptions.show&&!e.value.style.chart.title.text),Pe=c(()=>Le(e.value.customPalette)),x=s({showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}),n=s({height:512,width:512,padding:{top:64,left:64,right:64,bottom:64},minRadius:64}),R=s(null);He(()=>{ce()});function ce(){if(Ge(k.dataset)&&q({componentName:"VueUiOnion",type:"dataset"}),e.value.responsive){const a=et(()=>{const{width:l,height:t}=tt({chart:T.value,title:e.value.style.chart.title.text?Z.value:null,legend:e.value.style.chart.legend.show?ee.value:null,source:te.value,noTitle:ae.value});n.value.width=l,n.value.height=t,n.value.padding.top=Math.max(l,t)*.125,n.value.padding.right=Math.max(l,t)*.125,n.value.padding.bottom=Math.max(l,t)*.125,n.value.padding.left=Math.max(l,t)*.125,n.value.minRadius=Math.min(l,t)*.125});R.value=new ResizeObserver(a),R.value.observe(T.value.parentNode)}}Ee(()=>{R.value&&R.value.disconnect()});const i=c(()=>({top:n.value.padding.top,left:n.value.padding.left,right:n.value.width-n.value.padding.right,bottom:n.value.height-n.value.padding.bottom,centerX:n.value.width/2,centerY:n.value.height/2,width:n.value.width-n.value.padding.right-n.value.padding.left,height:n.value.height-n.value.padding.bottom-n.value.padding.top,minRadius:n.value.minRadius,maxRadius:Math.min(n.value.width,n.value.height)-n.value.padding.top*2})),v=c(()=>(k.dataset.forEach((a,l)=>{[null,void 0].includes(a.name)&&q({componentName:"VueUiOnion",type:"datasetSerieAttribute",property:"name",index:l}),[void 0].includes(a.percentage)&&q({componentName:"VueUiOnion",type:"datasetSerieAttribute",property:"percentage",index:l})}),k.dataset.map((a,l)=>{const t=`onion_serie_${l}_${C.value}`;return{...a,percentage:a.percentage||0,targetPercentage:a.percentage||0,color:Ue(a.color)||Pe.value[l]||ye[l],id:t,shape:"circle",opacity:y.value.includes(t)?.5:1,absoluteIndex:l,segregate:()=>de(t),isSegregated:y.value.includes(t)}}))),P=s(v.value),_e=c(()=>e.value.useStartAnimation),Ae=s(null),Me=c(()=>Math.max(...v.value.map(a=>a.percentage))),L=s(!1);me(()=>v.value,Fe,{immediate:!0});function Fe(){if(_e.value&&!L.value){let a=function(){l>=Me.value?(cancelAnimationFrame(Ae.value),P.value=v.value,L.value=!0):(P.value=v.value.map(t=>({...t,percentage:l<t.targetPercentage?l:t.targetPercentage})),l+=1,requestAnimationFrame(a),L.value=!0)};P.value=v.value.map(t=>({...t,percentage:0}));let l=0;a()}else P.value=v.value}const Se=c(()=>({cy:"onion-div-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:e.value.style.chart.legend.bold?"bold":""})),Ne=c(()=>v.value.filter(a=>!y.value.includes(a.id)).length),$=c(()=>{const a=Math.min(i.value.width,i.value.height)/2/v.value.length;return{gutter:(a>e.value.style.chart.layout.maxThickness?e.value.style.chart.layout.maxThickness:a)*e.value.style.chart.layout.gutter.width,track:(a>e.value.style.chart.layout.maxThickness?e.value.style.chart.layout.maxThickness:a)*e.value.style.chart.layout.track.width}}),m=c(()=>P.value.filter(a=>!y.value.includes(a.id)).map((a,l)=>{const t=(i.value.maxRadius-$.value.track)/Ne.value/2*(1+l),o=i.value.centerY-t;return{percentage:a.percentage||0,...a,labelY:o,radius:t,path:Be(t,a.percentage||0)}}));function Be(a,l){const t=2*Math.PI*a,o=t*.75,f=`${o} ${t}`,A=o*(1-l/100);return{bgDashArray:`${o} ${t}`,bgDashOffset:0,dashArray:f,dashOffset:A,fullOffset:0,active:`
            M ${i.value.centerX},${i.value.centerY-a} 
            A ${a},${a} 0 1 1 
            ${i.value.centerX+a*Math.cos(Math.PI*3/4)},${i.value.centerY+a*Math.sin(Math.PI*3/4)}
        `.trim()}}function de(a){y.value.includes(a)?y.value=y.value.filter(l=>l!==a):y.value.push(a),Ce("selectLegend",m.value)}function Ye(){return m.value}const H=c(()=>{const a=[e.value.table.translations.serie,e.value.table.translations.percentage,e.value.table.translations.value],l=m.value.map(t=>[t.name,t.percentage,t.value]);return{head:a,body:l}}),V=c(()=>{const a=H.value.head,l=m.value.map(o=>[`<span style="color:${o.color}">â¬¤</span> ${o.name}`,`${Number(o.percentage??0).toFixed(e.value.table.td.roundingPercentage).toLocaleString()}%`,`${o.prefix||""}${[null,void 0,NaN,"NaN"].includes(o.value)?"-":o.value.toFixed(e.value.table.td.roundingValue).toLocaleString()}${o.suffix||""}`]),t={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint};return{head:a,body:l,config:t,colNames:a}});function he(){We(()=>{const a=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[""]],l=H.value.head,t=H.value.body,o=a.concat([l]).concat(t),f=je(o);qe({csvContent:f,title:e.value.style.chart.title.text||"vue-ui-onion"})})}const b=s(void 0),_=s(!1);function ze(a){_.value=a,Q.value+=1}const E=s(null);function ge({datapoint:a,seriesIndex:l,show:t=!0}){const o=a.absoluteIndex;b.value=l,E.value={datapoint:a,seriesIndex:o,series:v.value,config:e.value},z.value=t;let f="";const A=e.value.style.chart.tooltip.customFormat;if(ke(A)&&Qe(()=>A({seriesIndex:o,datapoint:a,series:v.value,config:e.value})))G.value=A({seriesIndex:o,datapoint:a,series:v.value,config:e.value});else{const W=e.value.style.chart.tooltip.showPercentage,j=e.value.style.chart.tooltip.showValue;f+=`<div style="width: 100%; border-bottom: 1px solid ${e.value.style.chart.tooltip.borderColor}; padding-bottom: 6px;margin-bottom:3px;display:flex;flex-direction:row;gap:3px;align-items:center"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="${a.color}"/></svg><span></span>${a.name}</span></div>`,f+=`<div style="width:100%;text-align:left;"><b>${W?B({p:"",v:a.percentage,s:"%",r:e.value.style.chart.tooltip.roundingPercentage}):""}</b> ${W&&j?"(":""}${j?K(e.value.style.chart.layout.labels.value.formatter,a.value,B({p:a.prefix||"",v:a.value,s:a.suffix||"",r:e.value.style.chart.tooltip.roundingValue}),{datapoint:a,seriesIndex:l}):""}${W&&j?")":""}</div>`,G.value=`<div>${f}</div>`}}function pe(){x.value.showTable=!x.value.showTable}function fe(){x.value.showTooltip=!x.value.showTooltip}const D=s(!1);function U(){D.value=!D.value}return we({getData:Ye,generatePdf:ie,generateCsv:he,generateImage:ve,toggleTable:pe,toggleTooltip:fe,toggleAnnotator:U}),(a,l)=>(r(),u("div",{class:X(`vue-ui-onion ${_.value?"vue-data-ui-wrapper-fullscreen":""} ${e.value.useCssAnimation?"":"vue-ui-dna"}`),ref_key:"onionChart",ref:T,id:`vue-ui-onion_${C.value}`,style:J(`font-family:${e.value.style.fontFamily};width:100%; ${e.value.responsive?"height: 100%;":""} text-align:center;background:${e.value.style.chart.backgroundColor}`)},[e.value.userOptions.buttons.annotator?(r(),w(ct,{key:0,parent:T.value,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,active:D.value,onClose:U},null,8,["parent","backgroundColor","color","active"])):p("",!0),Ie.value?(r(),u("div",{key:1,ref_key:"noTitle",ref:ae,class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},null,512)):p("",!0),e.value.style.chart.title.text?(r(),u("div",{key:2,ref_key:"chartTitle",ref:Z,style:"width:100%;background:transparent"},[(r(),w(at,{key:`title_${le.value}`,config:{title:{cy:"onion-div-title",...e.value.style.chart.title},subtitle:{cy:"onion-div-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))],512)):p("",!0),e.value.userOptions.show&&Y.value?(r(),w(ot,{ref_key:"details",ref:Oe,key:`user_options${Q.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isImaging:g(ue),isPrinting:g(se),uid:C.value,hasTooltip:e.value.userOptions.buttons.tooltip&&e.value.style.chart.tooltip.show,hasPdf:e.value.userOptions.buttons.pdf,hasImg:e.value.userOptions.buttons.img,hasXls:e.value.userOptions.buttons.csv,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isFullscreen:_.value,isTooltip:x.value.showTooltip,titles:{...e.value.userOptions.buttonTitles},chartElement:T.value,position:e.value.userOptions.position,hasAnnotator:e.value.userOptions.buttons.annotator,isAnnotation:D.value,onToggleFullscreen:ze,onGeneratePdf:g(ie),onGenerateCsv:he,onGenerateImage:g(ve),onToggleTable:pe,onToggleTooltip:fe,onToggleAnnotator:U},Je({_:2},[a.$slots.optionTooltip?{name:"optionTooltip",fn:d(()=>[h(a.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,a.$slots.optionPdf?{name:"optionPdf",fn:d(()=>[h(a.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,a.$slots.optionCsv?{name:"optionCsv",fn:d(()=>[h(a.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,a.$slots.optionImg?{name:"optionImg",fn:d(()=>[h(a.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,a.$slots.optionTable?{name:"optionTable",fn:d(()=>[h(a.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,a.$slots.optionFullscreen?{name:"optionFullscreen",fn:d(({toggleFullscreen:t,isFullscreen:o})=>[h(a.$slots,"optionFullscreen",M(F({toggleFullscreen:t,isFullscreen:o})),void 0,!0)]),key:"5"}:void 0,a.$slots.optionAnnotator?{name:"optionAnnotator",fn:d(({toggleAnnotator:t,isAnnotator:o})=>[h(a.$slots,"optionAnnotator",M(F({toggleAnnotator:t,isAnnotator:o})),void 0,!0)]),key:"6"}:void 0]),1032,["backgroundColor","color","isImaging","isPrinting","uid","hasTooltip","hasPdf","hasImg","hasXls","hasTable","hasFullscreen","isFullscreen","isTooltip","titles","chartElement","position","hasAnnotator","isAnnotation","onGeneratePdf","onGenerateImage"])):p("",!0),Y.value?(r(),u("svg",{key:4,xmlns:g(Ke),class:X({"vue-data-ui-fullscreen--on":_.value,"vue-data-ui-fulscreen--off":!_.value}),viewBox:`0 0 ${n.value.width<=0?1e-4:n.value.width} ${n.value.height<=0?1e-4:n.value.height}`,style:J(`max-width:100%;overflow:visible;background:transparent;color:${e.value.style.chart.color}`)},[be(vt),(r(!0),u(S,null,N(m.value,(t,o)=>(r(),u("circle",{cx:i.value.centerX,cy:i.value.centerY,r:t.radius<=0?1e-4:t.radius,stroke:e.value.style.chart.layout.gutter.color,"stroke-width":$.value.gutter,fill:"none","stroke-dasharray":t.path.bgDashArray,"stroke-dashoffset":t.path.fullOffset,"stroke-linecap":"round",class:X({"vue-ui-onion-path":!0,"vue-ui-onion-blur":e.value.useBlurOnHover&&![null,void 0].includes(b.value)&&b.value!==o}),style:{transform:"rotate(-90deg)","transform-origin":"50% 50%"}},null,10,pt))),256)),(r(!0),u(S,null,N(m.value,(t,o)=>(r(),u("circle",{cx:i.value.centerX,cy:i.value.centerY,r:t.radius<0?1e-4:t.radius,stroke:`${t.color}`,"stroke-width":$.value.track,fill:"none","stroke-dasharray":t.path.dashArray,"stroke-dashoffset":t.path.dashOffset,class:X({"vue-ui-onion-path":!0,"vue-ui-onion-blur":e.value.useBlurOnHover&&![null,void 0].includes(b.value)&&b.value!==o}),"stroke-linecap":"round",style:{transform:"rotate(-90deg)","transform-origin":"50% 50%"}},null,10,ft))),256)),O("defs",null,[O("filter",{id:`blur_${C.value}`,x:"-50%",y:"-50%",width:"200%",height:"200%"},[O("feGaussianBlur",{in:"SourceGraphic",stdDeviation:100/e.value.style.chart.gradientIntensity},null,8,mt)],8,yt)]),e.value.style.chart.useGradient?(r(),u("g",{key:0,filter:`url(#blur_${C.value})`},[(r(!0),u(S,null,N(m.value,(t,o)=>(r(),u("circle",{cx:i.value.centerX,cy:i.value.centerY,r:t.radius<=0?1e-4:t.radius,stroke:"white","stroke-width":$.value.track/3,fill:"none","stroke-linecap":"round","stroke-dasharray":t.path.dashArray,"stroke-dashoffset":t.path.dashOffset,style:{transform:"rotate(-90deg)","transform-origin":"50% 50%"}},null,8,kt))),256))],8,bt)):p("",!0),(r(!0),u(S,null,N(m.value,(t,o)=>(r(),u("circle",{"data-cy-trap":"",cx:i.value.centerX,cy:i.value.centerY,r:t.radius<=0?1e-4:t.radius,stroke:"transparent","stroke-width":Math.max($.value.track,$.value.gutter),fill:"none","stroke-dasharray":t.path.bgDashArray,"stroke-dashoffset":t.path.fullOffset,"stroke-linecap":"round",class:"vue-ui-onion-path",style:{transform:"rotate(-90deg)","transform-origin":"50% 50%"},onMouseenter:f=>ge({datapoint:t,show:!0,seriesIndex:o}),onMouseleave:l[0]||(l[0]=f=>{b.value=void 0,z.value=!1})},null,40,xt))),256)),e.value.style.chart.layout.labels.show?(r(),u("g",$t,[(r(!0),u(S,null,N(m.value,(t,o)=>(r(),u("g",{onMouseenter:f=>ge({datapoint:t,show:!0,seriesIndex:o}),onMouseleave:l[1]||(l[1]=f=>{b.value=void 0,z.value=!1})},[y.value.includes(t.id)?p("",!0):(r(),u("text",{key:0,x:n.value.width/2-$.value.gutter*.8+e.value.style.chart.layout.labels.offsetX,y:t.labelY+e.value.style.chart.layout.labels.offsetY,"text-anchor":"end","font-size":e.value.style.chart.layout.labels.fontSize,fill:e.value.useBlurOnHover&&![null,void 0].includes(b.value)&&b.value===o?t.color:e.value.style.chart.layout.labels.color,"font-weight":e.value.style.chart.layout.labels.bold?"bold":"normal"},I(t.name?t.name+": ":"")+" "+I(e.value.style.chart.layout.labels.percentage.show?g(B)({v:t.percentage,s:"%",r:e.value.style.chart.layout.labels.roundingPercentage}):"")+" "+I(!e.value.style.chart.layout.labels.percentage.show&&e.value.style.chart.layout.labels.value.show?`: ${g(K)(e.value.style.chart.layout.labels.value.formatter,t.value,g(B)({p:t.prefix||"",v:t.value||0,s:t.suffix||"",r:e.value.style.chart.layout.labels.roundingValue}),{datapoint:t,seriesIndex:o})}`:`${e.value.style.chart.layout.labels.value.show&&t.value?`(${g(K)(e.value.style.chart.layout.labels.value.formatter,t.value,g(B)({p:t.prefix||"",v:t.value||0,s:t.suffix||"",r:e.value.style.chart.layout.labels.roundingValue}),{datapoint:t,seriesIndex:o})})`:""}`),9,Ct))],40,wt))),256))])):p("",!0),h(a.$slots,"svg",{svg:n.value},void 0,!0)],14,gt)):p("",!0),a.$slots.watermark?(r(),u("div",Tt,[h(a.$slots,"watermark",M(F({isPrinting:g(se)||g(ue)})),void 0,!0)])):p("",!0),Y.value?p("",!0):(r(),w(ut,{key:6,config:{type:"onion",style:{backgroundColor:e.value.style.chart.backgroundColor,onion:{color:e.value.style.chart.layout.gutter.color}}}},null,8,["config"])),O("div",{ref_key:"chartLegend",ref:ee},[e.value.style.chart.legend.show?(r(),w(nt,{key:`legend_${ne.value}`,legendSet:v.value,config:Se.value,onClickMarker:l[2]||(l[2]=({legend:t})=>de(t.id))},{item:d(({legend:t})=>[O("div",{"data-cy-legend-item":"",onClick:o=>t.segregate(),style:J(`opacity:${y.value.includes(t.id)?.5:1}`)},I(t.name?t.name+": ":"")+" "+I((t.percentage||0).toFixed(e.value.style.chart.legend.roundingPercentage))+"% ",13,Ot)]),_:1},8,["legendSet","config"])):h(a.$slots,"legend",{key:1,legend:v.value},void 0,!0)],512),a.$slots.source?(r(),u("div",{key:7,ref_key:"source",ref:te,dir:"auto"},[h(a.$slots,"source",{},void 0,!0)],512)):p("",!0),be(st,{show:x.value.showTooltip&&z.value,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,fontSize:e.value.style.chart.tooltip.fontSize,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:T.value,content:G.value,isCustom:g(ke)(e.value.style.chart.tooltip.customFormat)},{"tooltip-before":d(()=>[h(a.$slots,"tooltip-before",M(F({...E.value})),void 0,!0)]),"tooltip-after":d(()=>[h(a.$slots,"tooltip-after",M(F({...E.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","borderRadius","borderColor","borderWidth","fontSize","backgroundOpacity","position","offsetY","parent","content","isCustom"]),Y.value?(r(),w(it,{key:8,hideDetails:"",config:{open:x.value.showTable,maxHeight:1e4,head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:d(()=>[(r(),w(rt,{key:`table_${oe.value}`,colNames:V.value.colNames,head:V.value.head,body:V.value.body,config:V.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:l[3]||(l[3]=t=>x.value.showTable=!1)},{th:d(({th:t})=>[Ze(I(t),1)]),td:d(({td:t})=>[O("div",{innerHTML:t},null,8,It)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):p("",!0)],14,ht))}},Lt=dt(Pt,[["__scopeId","data-v-cd5ffaad"]]);export{Lt as default};
