import{z as H,c as g,r as b,D as T,R as J,A as x,H as R,w as V,E as Z,b as K,B as Q,C as D,K as X,Z as Y,Q as ee,o as r,a as v,m as $,p as O,v as te,L as d,M as y,e as c,h as p,P as I,k as ae,q as le,u as o,U as k,G as w,J as se,f as oe,O as S,a1 as ie,i as re}from"./index-DWKgdAH2.js";import{c as j}from"./useNestedProp-BxrcwmTZ-DuVaLmrv.js";import ue from"./vue-ui-skeleton-Dgzcn3FL-QTPCyjXQ.js";import{p as ne}from"./PackageVersion-mSsg8dpu-BMuAJ9y0.js";import"./vue-data-ui-DF7u-eZV-BLQGmUKN.js";const ve=["onClick"],de={key:1},ce=["xmlns","viewBox"],ye=["id"],pe=["stop-color"],me=["stop-color"],fe=["height","width","fill","rx"],ge=["height","width","fill","rx"],he=["height","width","fill","rx"],be={key:2,ref:"source",dir:"auto"},Se={__name:"vue-ui-sparkbar",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}},backgroundOpacity:{type:Number,default:null}},emits:["selectDatapoint"],setup(C,{emit:q}){const l=C,{vue_ui_sparkbar:E}=H(),_=g(()=>!!l.dataset&&l.dataset.length),A=b(T()),e=g({get:()=>z(),set:t=>t});function z(){const t=j({userConfig:l.config,defaultConfig:E});return t.theme?{...j({userConfig:R.vue_ui_sparkbar[t.theme]||l.config,defaultConfig:t}),customPalette:J[t.theme]||x}:t}V(()=>l.config,t=>{e.value=z()},{deep:!0});const L=g(()=>Z(e.value.customPalette)),m=b(l.dataset.map(t=>({...t,value:e.value.style.animation.show?0:t.value||0,formatter:t.formatter||null}))),B=b(null);K(async()=>{Q(l.dataset)&&D({componentName:"VueUiSparkbar",type:"dataset"}),F()});function F(){if(e.value.style.animation.show){let t=function(){P+=n/s,P<n?(m.value=m.value.map((i,h)=>({...i,value:i.value+=a[h]})),B.value=requestAnimationFrame(t)):m.value=l.dataset.map(i=>({...i,value:i.value||0,formatter:i.formatter||null}))};const s=e.value.style.animation.animationFrames,a=l.dataset.map((i,h)=>i.value/s),n=l.dataset.map(i=>i.value||0).reduce((i,h)=>i+h,0);let P=0;t()}}V(()=>l.dataset,async t=>{cancelAnimationFrame(B.value),m.value=l.dataset.map(s=>({...s,value:e.value.style.animation.show?0:s.value||0,formatter:s.formatter||null})),X(F)},{deep:!0});const u=b({width:500,height:16}),M=g(()=>Math.max(...l.dataset.map(t=>t.value))),U=g(()=>(l.dataset.forEach((t,s)=>{Y({datasetObject:t,requiredAttributes:["name","value"]}).forEach(a=>{D({componentName:"VueUiSparkbar",type:"datasetSerieAttribute",property:a,index:s})})}),m.value.map((t,s)=>({...t,value:t.value||0,color:ee(t.color)||L.value[s]||x[s]||x[s%x.length]}))));function W(t){return t/M.value}function N(t){return e.value.style.layout.independant?t.target?t.value/t.target:e.value.style.layout.percentage?t.value>100?1:t.value/100:e.value.style.layout.target===0?1:t.value/e.value.style.layout.target:W(t.value)}function f(t){return e.value.style.layout.independant&&t.target||e.value.style.layout.target}function G(t,s){q("selectDatapoint",{datapoint:t,index:s})}return(t,s)=>(r(),v("div",{style:y({width:"100%",fontFamily:e.value.style.fontFamily,background:l.backgroundOpacity!==null?o(S)(e.value.style.backgroundColor,l.backgroundOpacity):e.value.style.backgroundColor})},[t.$slots.title?$(t.$slots,"title",O(te({key:0},{title:{...t.title,title:e.value.style.title.text,subtitle:e.value.style.title.subtitle.text}}))):d("",!0),!t.$slots.title&&e.value.style.title.text?(r(),v("div",{key:1,class:"vue-ui-sparkbar-title-container",style:y({background:e.value.style.title.backgroundColor,margin:e.value.style.title.margin,textAlign:e.value.style.title.textAlign})},[c("div",{class:"vue-ui-sparkbar-title",style:y({fontSize:e.value.style.title.fontSize+"px",color:e.value.style.title.color,fontWeight:e.value.style.title.bold?"bold":"normal"})},p(e.value.style.title.text),5),e.value.style.title.subtitle.text?(r(),v("div",{key:0,class:"vue-ui-sparkbar-subtitle",style:y({fontSize:e.value.style.title.subtitle.fontSize+"px",color:e.value.style.title.subtitle.color,fontWeight:e.value.style.title.subtitle.bold?"bold":"normal"})},p(e.value.style.title.subtitle.text),5)):d("",!0)],4)):d("",!0),(r(!0),v(I,null,ae(U.value,(a,n)=>(r(),v(I,null,[_.value?(r(),v("div",{key:0,style:y(`display:flex !important;${["left","right"].includes(e.value.style.labels.name.position)?`flex-direction: ${e.value.style.labels.name.position==="right"?"row-reverse":"row"} !important`:"flex-direction:column !important"};gap:${e.value.style.gap}px !important;align-items:center;${C.dataset.length>0&&n!==C.dataset.length-1?"margin-bottom:6px":""}`),onClick:()=>G(a,n)},[$(t.$slots,"data-label",O(le({bar:{...a,target:f(a),valueLabel:o(k)(a.formatter,a.value,o(w)({p:a.prefix||"",v:a.value,s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:n}),targetLabel:o(k)(a.formatter,f(a),o(w)({p:a.prefix||"",v:f(a),s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:n})}}))),t.$slots["data-label"]?d("",!0):(r(),v("div",{key:0,style:y({width:e.value.style.labels.name.width,color:e.value.style.labels.name.color,fontSize:e.value.style.labels.fontSize+"px",fontWeight:e.value.style.labels.name.bold?"bold":"normal",textAlign:["left","right"].includes(e.value.style.labels.name.position)||["top","top-left"].includes(e.value.style.labels.name.position)?"left":e.value.style.labels.name.position==="top-center"?"center":"right"})},[c("span",null,p(a.name),1),e.value.style.labels.value.show?(r(),v("span",{key:0,style:y(`font-weight:${e.value.style.labels.value.bold?"bold":"normal"}`)},": "+p(o(k)(a.formatter,a.value,o(w)({p:a.prefix||"",v:a.value,s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:n})),5)):d("",!0),e.value.style.layout.showTargetValue?(r(),v("span",de,p(" "+e.value.style.layout.targetValueText)+" "+p(o(k)(a.formatter,f(a),o(w)({p:a.prefix||"",v:f(a),s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:n})),1)):d("",!0)],4)),(r(),v("svg",{xmlns:o(se),viewBox:`0 0 ${u.value.width} ${u.value.height}`,width:"100%"},[oe(ne),c("defs",null,[c("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"0%",id:`sparkbar_gradient_${n}_${A.value}`},[c("stop",{offset:"0%","stop-color":o(S)(o(ie)(a.color,.03),100-e.value.style.bar.gradient.intensity)},null,8,pe),c("stop",{offset:"100%","stop-color":a.color},null,8,me)],8,ye)]),c("rect",{height:u.value.height,width:u.value.width,x:0,y:0,fill:o(S)(e.value.style.gutter.backgroundColor,e.value.style.gutter.opacity),rx:u.value.height/2},null,8,fe),c("rect",{height:u.value.height,width:u.value.width*N(a),x:0,y:0,fill:e.value.style.bar.gradient.underlayerColor,rx:u.value.height/2},null,8,ge),c("rect",{height:u.value.height,width:u.value.width*N(a),x:0,y:0,fill:e.value.style.bar.gradient.show?`url(#sparkbar_gradient_${n}_${A.value})`:a.color,rx:u.value.height/2},null,8,he)],8,ce))],12,ve)):d("",!0)],64))),256)),t.$slots.source?(r(),v("div",be,[$(t.$slots,"source")],512)):d("",!0),_.value?d("",!0):(r(),re(ue,{key:3,config:{type:"sparkbar",style:{backgroundColor:e.value.style.backgroundColor,sparkbar:{color:"#CCCCCC"}}}},null,8,["config"]))],4))}};export{Se as default};
