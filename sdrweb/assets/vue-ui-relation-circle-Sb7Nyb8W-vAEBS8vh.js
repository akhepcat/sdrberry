import{af as Ce,c,r as i,z as _e,R as Ae,A as ae,H as Oe,D as Pe,w as Ie,B as Fe,C as oe,Z as Ee,E as ze,b as Be,ac as je,o,a as n,i as A,L as g,j as Se,l as O,m as h,p as S,q as M,u as p,n as T,J as Me,f as Te,e as Ne,P,k as I,M as w,h as Ve}from"./index-CMbgrvzv.js";import{O as Le,k as Ge}from"./useResponsive-CoxXLe23-CoJWR8uA.js";import{x as Re}from"./Title-DyD-mBPN-B9325m01.js";import{r as qe,a as De}from"./usePrinter-CLcxWv-4-ChR9zFwY.js";import He from"./vue-ui-skeleton-Dgzcn3FL-nxJtxydg.js";import{c as ie}from"./useNestedProp-BxrcwmTZ-DfxG55sS.js";import{p as Je}from"./PackageVersion-mSsg8dpu-CbvTnp2w.js";import{S as Ue}from"./PenAndPaper-Dk41ZrJ0-Cv0BF8yJ.js";import{s as Ye}from"./vue-data-ui-DF7u-eZV-DHaDTFza.js";const Ze=["id"],We=["xmlns","viewBox"],Ke=["cx","cy","r","stroke","stroke-width"],Qe={key:0},Xe=["stroke","d","stroke-width"],et={key:1},tt=["stroke","x1","x2","y1","y2"],lt=["text-anchor","transform","x","y","onClick","font-weight","font-size","fill"],at=["cx","cy","fill","onClick","r"],ot={key:5,class:"vue-data-ui-watermark"},it={__name:"vue-ui-relation-circle",props:{dataset:{type:Array,default(){return[]}},config:{type:Object,default(){return{}}}},setup(ne,{expose:re}){const v=ne;Ce(e=>({"47419f48":ge.value,"77774d27":de.value,df46026e:ye.value}));const{vue_ui_relation_circle:se}=_e(),F=c(()=>!!v.dataset&&Object.keys(v.dataset).length),k=i(Pe()),N=i(0),$=i(null),V=i(null),L=i(null),G=i(null),R=i(0),l=c({get:()=>q(),set:e=>e});function q(){const e=ie({userConfig:v.config,defaultConfig:se});return e.theme?{...ie({userConfig:Oe.vue_ui_relation_circle[e.theme]||v.config,defaultConfig:e}),customPalette:Ae[e.theme]||ae}:e}Ie(()=>v.config,e=>{l.value=q(),Z(),R.value+=1},{deep:!0});const{isPrinting:D,isImaging:H,generatePdf:J,generateImage:U}=qe({elementId:`relation_circle_${k.value}`,fileName:l.value.style.title.text||"vue-ui-relation-circle"}),ue=c(()=>l.value.userOptions.show&&!l.value.style.title.text),Y=c(()=>ze(l.value.customPalette)),y=i([]),m=i([]),r=i({}),d=i([]),ce=i(0),E=c(()=>v.dataset.slice(0,l.value.style.limit)),z=i(l.value.style.size),s=i({height:l.value.style.size,width:l.value.style.size}),f=c({get(){return z.value*l.value.style.circle.radiusProportion},set(e){return e}}),ve=c(()=>l.value.style.links.curved),de=c(()=>`${l.value.style.animation.speedMs}ms`),ge=c(()=>f.value*2),ye=c(()=>f.value*4),b=i(null);Be(()=>{Z(),document.getElementById(`relation_circle_${k.value}`).addEventListener("click",W)});function Z(){if(Fe(v.dataset)?oe({componentName:"VueUiRelationCircle",type:"dataset"}):v.dataset.forEach((e,a)=>{Ee({datasetObject:e,requiredAttributes:["id","label","relations","weights"]}).forEach(t=>{oe({componentName:"VueUiRelationCircle",type:"datasetSerieAttribute",property:t,index:a})})}),l.value.responsive){const e=Le(()=>{const{width:a,height:t}=Ge({chart:$.value,title:l.value.style.title.text?V.value:null,source:L.value,noTitle:G.value});z.value=Math.min(a,t),s.value.width=a,s.value.height=t,f.value=z.value*l.value.style.circle.radiusProportion,y.value=[],m.value=[],K(),Q()});b.value=new ResizeObserver(e),b.value.observe($.value.parentNode)}else y.value=[],m.value=[],K(),Q()}je(()=>{document.getElementById(`relation_circle_${k.value}`).removeEventListener("click",W),b.value&&b.value.disconnect()});function W(e){const a=e.target;a&&Array.from(a.classList).includes("vue-ui-user-options")||a&&Array.from(a.classList).includes("vue-ui-user-options-summary")||a&&Array.from(a.classList).includes("vue-data-ui-button")||a&&Array.from(a.classList).includes("vue-ui-relation-circle-legend")||(r.value={},d.value=[])}function K(){const e=6.28319/E.value.length,a=360/E.value.length;let t=0,u=0;E.value.forEach((x,j)=>{const we=f.value*Math.cos(t)+s.value.width/2,be=f.value*Math.sin(t)+s.value.height/2+l.value.style.circle.offsetY;y.value.push({x:we,y:be,...x,color:x.color?x.color:Y.value[j]?Y.value[j]:ae[j],regAngle:u}),t+=e,u+=a})}function Q(){y.value.forEach(e=>{y.value.filter(a=>a.relations.includes(e.id)).forEach((a,t)=>{m.value.push({weight:e.weights&&e.weights[t]?e.weights[t]:1,relationId:`${e.id}_${a.id}`,x1:e.x,y1:e.y,x2:a.x,y2:a.y,colorSource:e.color,colorTarget:a.color,...e})})})}const fe=c(()=>Math.max(...m.value.map(e=>e.weight)));function he(e){return Object.hasOwn(r.value,"x")?d.value.includes(e.id)?"opacity:1":"opacity:0.1":"opacity:1"}function X(e){return Object.hasOwn(r.value,"x")?e.colorTarget:e.colorSource}function ee(e){return Object.hasOwn(r.value,"x")?d.value.includes(e.id)&&e.relationId===`${e.id}_${r.value.id}`||e.relationId===`${r.value.id}_${e.id}`?`opacity:1;stroke-width:${le(e)}`:"opacity: 0":"opacity: 1"}function pe(e){return e.regAngle>90&&e.regAngle<270?"end":"start"}function me(e){return e.regAngle>90&&e.regAngle<270?e.x-5:e.x+5}function ke(e){return Object.hasOwn(r.value,"x")?r.value.id===e.id||d.value.includes(e.id)?"opacity:1":"opacity:0.2":"opacity:1"}function $e(e){return e.regAngle>90&&e.regAngle<270?`rotate(${e.regAngle+180},${e.x},${e.y})`:`rotate(${e.regAngle},${e.x},${e.y})`}function te(e){ce.value=360-e.regAngle,r.value.id&&e.id===r.value.id?(r.value={},d.value=[]):(r.value=e,d.value=[...e.relations])}function le(e){return e.weight/fe.value*l.value.style.links.maxWidth}const C=i(!1);function xe(e){C.value=e,N.value+=1}const _=i(!1);function B(){_.value=!_.value}return re({generatePdf:J,generateImage:U,toggleAnnotator:B}),(e,a)=>(o(),n("div",{ref_key:"relationCircleChart",ref:$,class:"vue-ui-relation-circle",style:w(`width:100%;background:${l.value.style.backgroundColor};text-align:center;${l.value.responsive?"height: 100%":""}`),id:`relation_circle_${k.value}`},[l.value.userOptions.buttons.annotator?(o(),A(Ue,{key:0,parent:$.value,backgroundColor:l.value.style.backgroundColor,color:l.value.style.color,active:_.value,onClose:B},null,8,["parent","backgroundColor","color","active"])):g("",!0),ue.value?(o(),n("div",{key:1,ref_key:"noTitle",ref:G,class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},null,512)):g("",!0),l.value.style.title.text?(o(),n("div",{key:2,ref_key:"chartTitle",ref:V,style:"width:100%;background:transparent"},[(o(),A(Re,{key:`title_${R.value}`,config:{title:{cy:"relation-div-title",...l.value.style.title},subtitle:{cy:"relation-div-subtitle",...l.value.style.title.subtitle}}},null,8,["config"]))],512)):g("",!0),l.value.userOptions.show&&F.value?(o(),A(De,{ref:"details",key:`user_options_${N.value}`,backgroundColor:l.value.style.backgroundColor,color:l.value.style.color,isPrinting:p(D),isImaging:p(H),uid:k.value,hasPdf:l.value.userOptions.buttons.pdf,hasImg:l.value.userOptions.buttons.img,hasFullscreen:l.value.userOptions.buttons.img,hasXls:!1,isFullscreen:C.value,titles:{...l.value.userOptions.buttonTitles},chartElement:$.value,position:l.value.userOptions.position,hasAnnotator:l.value.userOptions.buttons.annotator,isAnnotation:_.value,onToggleFullscreen:xe,onGeneratePdf:p(J),onGenerateImage:p(U),onToggleAnnotator:B},Se({_:2},[e.$slots.optionPdf?{name:"optionPdf",fn:O(()=>[h(e.$slots,"optionPdf",{},void 0,!0)]),key:"0"}:void 0,e.$slots.optionImg?{name:"optionImg",fn:O(()=>[h(e.$slots,"optionImg",{},void 0,!0)]),key:"1"}:void 0,e.$slots.optionFullscreen?{name:"optionFullscreen",fn:O(({toggleFullscreen:t,isFullscreen:u})=>[h(e.$slots,"optionFullscreen",S(M({toggleFullscreen:t,isFullscreen:u})),void 0,!0)]),key:"2"}:void 0,e.$slots.optionAnnotator?{name:"optionAnnotator",fn:O(({toggleAnnotator:t,isAnnotator:u})=>[h(e.$slots,"optionAnnotator",S(M({toggleAnnotator:t,isAnnotator:u})),void 0,!0)]),key:"3"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasPdf","hasImg","hasFullscreen","isFullscreen","titles","chartElement","position","hasAnnotator","isAnnotation","onGeneratePdf","onGenerateImage"])):g("",!0),F.value?(o(),n("svg",{key:4,xmlns:p(Me),class:T([{"vue-data-ui-fullscreen--on":C.value,"vue-data-ui-fulscreen--off":!C.value},"relation-circle"]),viewBox:`0 0 ${s.value.width<=0?10:s.value.width} ${s.value.height<=0?10:s.value.height}`,width:"100%",style:"user-select:none; background:transparent"},[Te(Je),Ne("circle",{cx:(s.value.width<=0?1e-4:s.value.width)/2,cy:(s.value.height<=0?1e-4:s.value.height)/2+l.value.style.circle.offsetY,r:f.value<=0?1e-4:f.value,stroke:l.value.style.circle.stroke,"stroke-width":l.value.style.circle.strokeWidth,fill:"transparent",class:"main-circle"},null,8,Ke),ve.value?(o(),n("g",Qe,[(o(!0),n(P,null,I(m.value,(t,u)=>(o(),n("path",{key:`relation_${u}`,style:w(ee(t)),stroke:X(t),class:T(["relation",{"vue-ui-relation-circle-selected":r.value.hasOwnProperty("id")&&d.value.includes(t.id)}]),d:`M${t.x1},${t.y1} C${t.x1},${t.y1} ${s.value.width/2},${s.value.height/2+l.value.style.circle.offsetY} ${t.x2},${t.y2}`,fill:"none","stroke-width":le(t),"stroke-linecap":"round"},null,14,Xe))),128))])):(o(),n("g",et,[(o(!0),n(P,null,I(m.value,(t,u)=>(o(),n("line",{key:`relation_${u}`,stroke:X(t),style:w(ee(t)),x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,class:T({"vue-ui-relation-circle-selected":r.value.hasOwnProperty("id")&&d.value.includes(t.id)}),"stroke-linecap":"round"},null,14,tt))),128))])),(o(!0),n(P,null,I(y.value,(t,u)=>(o(),n("text",{key:`plot_text_${u}`,"text-anchor":pe(t),transform:$e(t),x:me(t),y:t.y+5,onClick:x=>te(t),class:"vue-ui-relation-circle-legend","transform-origin":"start","font-weight":r.value.id===t.id?"900":"400",style:w(`font-family:${l.value.style.fontFamily};${ke(t)}`),"font-size":l.value.style.labels.fontSize,fill:l.value.style.labels.color},Ve(t.label),13,lt))),128)),(o(!0),n(P,null,I(y.value,(t,u)=>(o(),n("circle",{cx:t.x,cy:t.y,key:`plot_${u}`,style:w(he(t)),class:"vue-ui-relation-circle-plot",fill:l.value.style.plot.color,onClick:x=>te(t),r:l.value.style.plot.radius},null,12,at))),128)),h(e.$slots,"svg",{svg:s.value},void 0,!0)],10,We)):g("",!0),e.$slots.watermark?(o(),n("div",ot,[h(e.$slots,"watermark",S(M({isPrinting:p(D)||p(H)})),void 0,!0)])):g("",!0),e.$slots.source?(o(),n("div",{key:6,ref_key:"source",ref:L,dir:"auto"},[h(e.$slots,"source",{},void 0,!0)],512)):g("",!0),F.value?g("",!0):(o(),A(He,{key:7,config:{type:"relationCircle",style:{backgroundColor:l.value.style.backgroundColor,relationCircle:{color:"#CCCCCC"}}}},null,8,["config"]))],12,Ze))}},ft=Ye(it,[["__scopeId","data-v-a4837ff7"]]);export{ft as default};
