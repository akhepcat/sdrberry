import{z as Be,r as u,c as v,D as ye,R as ze,A as T,H as Re,w as We,B as Ee,C as q,Z as Ge,b as He,ac as je,E as De,ak as Ue,Q as me,G as _,K as Xe,V as qe,N as Je,o as r,a as y,i as N,L as k,j as Ke,l as g,m as p,p as F,q as L,u as i,M as V,n as G,J as Ye,f as fe,e as $,P as be,k as ke,O as Ze,a1 as Qe,a0 as J,a2 as et,a3 as tt,U as $e,g as we,h as H}from"./index-UNQvOp-_.js";import{O as lt,k as at}from"./useResponsive-CoxXLe23-CoJWR8uA.js";import{x as ot}from"./Title-DyD-mBPN-D1JKsC4v.js";import{r as st,a as ut}from"./usePrinter-CLcxWv-4-BCaxEi1-.js";import{E as rt}from"./Tooltip-qod9o4Vz-yuZ96RAr.js";import{W as nt}from"./DataTable-D8fcY_sJ-DwUEw2sq.js";import{C as it}from"./Legend-BorSDXCj-BlB-FUJn.js";import vt from"./vue-ui-skeleton-Dgzcn3FL-BesRK3Fh.js";import ct from"./vue-ui-accordion-m8rut1bP-B24xq09o.js";import{c as Ce}from"./useNestedProp-BxrcwmTZ-CudEJDco.js";import{p as dt}from"./PackageVersion-mSsg8dpu-BpMA5JNq.js";import{S as gt}from"./PenAndPaper-Dk41ZrJ0-C6X1XG5F.js";import{s as pt}from"./vue-data-ui-DF7u-eZV-Cm3hFNaA.js";import"./Shape-DYFnvMNd-Cz606loY.js";const ht=["id"],yt=["xmlns","viewBox"],mt=["id"],ft=["stop-color"],bt=["stop-color"],kt=["stroke","cx","cy","r","fill"],$t=["stroke","stroke-width","cx","cy","r","fill"],wt=["cx","cy","r","onMouseenter"],Ct={key:5,class:"vue-data-ui-watermark"},xt=["onClick"],Tt={key:0},_t={key:1},Nt=["innerHTML"],Pt={__name:"vue-ui-rings",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectLegend"],setup(xe,{expose:Te,emit:_e}){const m=xe,{vue_ui_rings:Ne}=Be(),A=u(!1),M=v(()=>!!m.dataset&&m.dataset.length),O=u(ye()),Pe=u(null),B=u(!1),j=u(""),x=u(null),K=u(0),P=u(null),Y=u(null),Z=u(null),Q=u(null),ee=u(null),te=u(0),le=u(0),ae=u(0),e=v({get:()=>oe(),set:t=>t});function oe(){const t=Ce({userConfig:m.config,defaultConfig:Ne});return t.theme?{...Ce({userConfig:Re.vue_ui_rings[t.theme]||m.config,defaultConfig:t}),customPalette:ze[t.theme]||T}:t}We(()=>m.config,t=>{e.value=oe(),se(),te.value+=1,le.value+=1,ae.value+=1},{deep:!0});const z=u(null);He(()=>{se()});function se(){if(Ee(m.dataset)?q({componentName:"VueUiRings",type:"dataset"}):m.dataset.forEach((t,a)=>{t.values.length||q({componentName:"VueUiRings",type:"dataset"}),Ge({datasetObject:t,requiredAttributes:["name","values"]}).forEach(l=>{q({componentName:"VueUiRings",type:"datasetSerieAttribute",property:l,index:a})})}),e.value.responsive){const t=lt(()=>{const{width:a,height:l}=at({chart:P.value,title:e.value.style.chart.title.text?Y.value:null,legend:e.value.style.chart.legend.show?Z.value:null,source:Q.value,noTitle:ee.value});n.value.width=a,n.value.height=l});z.value=new ResizeObserver(t),z.value.observe(P.value.parentNode)}setTimeout(()=>{A.value=!0},600)}je(()=>{z.value&&z.value.disconnect()});const{isPrinting:ue,isImaging:re,generatePdf:ne,generateImage:ie}=st({elementId:`rings_${O.value}`,fileName:e.value.style.chart.title.text||"vue-ui-rings"}),Ae=v(()=>e.value.userOptions.show&&!e.value.style.chart.title.text),ve=v(()=>De(e.value.customPalette)),w=u({showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}),n=u({height:360,width:360}),Oe=v(()=>Math.min(n.value.height,n.value.width)),c=u([]);function D(t){c.value.includes(t)?c.value=c.value.filter(a=>a!==t):c.value.push(t),_e("selectLegend",d.value.map(a=>({name:a.name,color:a.color,value:a.value})))}const Ie=v(()=>Math.max(...R.value.filter(t=>!c.value.includes(t.uid)).map(({value:t})=>t)));function ce(t){return t/Ie.value}const R=v(()=>m.dataset.map(({values:t,name:a,color:l=null},o)=>{const s=Ue(t).reduce((b,S)=>b+S,0);return{name:a,color:l||me(l)||ve.value[o]||T[o]||T[o%T.length],value:s,proportion:s/m.dataset.map(b=>(b.values||[]).reduce((S,Me)=>S+Me,0)).reduce((b,S)=>b+S,0),uid:ye()}})),de=v(()=>R.value.map(t=>({...t,shape:"circle",opacity:c.value.includes(t.uid)?.5:1,segregate:()=>D(t.uid),isSegregated:c.value.includes(t.uid)})).toSorted((t,a)=>a.value-t.value)),Se=v(()=>({cy:"rings-div-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:e.value.style.chart.legend.bold?"bold":""})),f=v(()=>R.value.filter(t=>!c.value.includes(t.uid)).map(({value:t})=>t).reduce((t,a)=>t+a,0)),d=v(()=>R.value.filter(t=>!c.value.includes(t.uid)).map(({name:t,value:a,color:l=null,uid:o},s)=>({uid:o,name:t,color:l||me(l)||ve.value[s]||T[s]||T[s%T.length],value:a,proportion:ce(a),percentage:a/f.value*100,strokeWidth:e.value.style.chart.layout.rings.strokeWidth*ce(a)})).toSorted((t,a)=>a.value-t.value));function Fe(){return d.value.map(({name:t,color:a,value:l,absoluteValues:o,percentage:s})=>({name:t,color:a,value:l,absoluteValues:o,percentage:s}))}const h=v(()=>Oe.value-e.value.style.chart.layout.rings.strokeWidth*2),U=u(null);function Le(t,a){if(c.value.length===m.dataset.length)return;U.value={datapoint:a,seriesIndex:t,series:d.value,config:e.value},x.value=t;const l=d.value[t],o=e.value.style.chart.tooltip.customFormat;if(et(o)&&tt(()=>o({seriesIndex:t,datapoint:a,series:d.value,config:e.value})))j.value=o({seriesIndex:t,datapoint:a,series:d.value,config:e.value});else{let s="";s+=`<div style="width:100%;text-align:center;border-bottom:1px solid ${e.value.style.chart.tooltip.borderColor};padding-bottom:6px;margin-bottom:3px;">${l.name}</div>`,s+=`<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="${l.color}" /></svg>`,e.value.style.chart.tooltip.showValue&&(s+=`<b>${$e(e.value.style.chart.layout.labels.dataLabels.formatter,l.value,_({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:l.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.tooltip.roundingValue}),{datapoint:a,seriesIndex:t})}
      </b>`),e.value.style.chart.tooltip.showPercentage&&(e.value.style.chart.tooltip.showValue?s+=`<span>(${_({v:l.value/f.value*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})})</span></div>`:s+=`<b>${_({v:l.value/f.value*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})}</b></div>`),j.value=s}B.value=!0}const C=v(()=>{const t=d.value.map(l=>({name:l.name,color:l.color})),a=d.value.map(l=>l.value);return{head:t,body:a}}),W=v(()=>{const t=[' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>',_({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:f.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue}),"100%"],a=C.value.head.map((s,b)=>[{color:s.color,name:s.name},_({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:C.value.body[b],s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue}),isNaN(C.value.body[b]/f.value)?"-":(C.value.body[b]/f.value*100).toFixed(e.value.table.td.roundingPercentage)+"%"]),l={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint},o=[e.value.table.columnNames.series,e.value.table.columnNames.value,e.value.table.columnNames.percentage];return{head:t,body:a,config:l,colNames:o}});function ge(){Xe(()=>{const t=C.value.head.map((o,s)=>[[o.name],[C.value.body[s]],[isNaN(C.value.body[s]/f.value)?"-":C.value.body[s]/f.value*100]]),a=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[""],["val"],["%"]]].concat(t),l=qe(a);Je({csvContent:l,title:e.value.style.chart.title.text||"vue-ui-rings"})})}const I=u(!1);function Ve(t){I.value=t,K.value+=1}function pe(){w.value.showTable=!w.value.showTable}function he(){w.value.showTooltip=!w.value.showTooltip}const E=u(!1);function X(){E.value=!E.value}return Te({getData:Fe,generatePdf:ne,generateCsv:ge,generateImage:ie,toggleTable:pe,toggleTooltip:he,toggleAnnotator:X}),(t,a)=>(r(),y("div",{ref_key:"ringsChart",ref:P,class:G(`vue-ui-rings ${I.value?"vue-data-ui-wrapper-fullscreen":""} ${e.value.useCssAnimation?"":"vue-ui-dna"}`),style:V(`font-family:${e.value.style.fontFamily};text-align:center;width:100%;background:${e.value.style.chart.backgroundColor};${e.value.responsive?"height: 100%":""}`),id:`rings_${O.value}`,onMouseleave:a[3]||(a[3]=l=>{x.value=null,B.value=!1})},[e.value.userOptions.buttons.annotator?(r(),N(gt,{key:0,parent:P.value,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,active:E.value,onClose:X},null,8,["parent","backgroundColor","color","active"])):k("",!0),Ae.value?(r(),y("div",{key:1,ref_key:"noTitle",ref:ee,class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},null,512)):k("",!0),e.value.style.chart.title.text?(r(),y("div",{key:2,ref_key:"chartTitle",ref:Y,style:"width:100%;background:transparent"},[(r(),N(ot,{key:`title_${te.value}`,config:{title:{cy:"rings-div-title",...e.value.style.chart.title},subtitle:{cy:"rings-div-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))],512)):k("",!0),e.value.userOptions.show&&M.value?(r(),N(ut,{ref_key:"details",ref:Pe,key:`user_options_${K.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:i(ue),isImaging:i(re),uid:O.value,hasTooltip:e.value.userOptions.buttons.tooltip&&e.value.style.chart.tooltip.show,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isTooltip:w.value.showTooltip,isFullscreen:I.value,titles:{...e.value.userOptions.buttonTitles},chartElement:P.value,position:e.value.userOptions.position,hasAnnotator:e.value.userOptions.buttons.annotator,isAnnotation:E.value,onToggleFullscreen:Ve,onGeneratePdf:i(ne),onGenerateCsv:ge,onGenerateImage:i(ie),onToggleTable:pe,onToggleTooltip:he,onToggleAnnotator:X},Ke({_:2},[t.$slots.optionTooltip?{name:"optionTooltip",fn:g(()=>[p(t.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,t.$slots.optionPdf?{name:"optionPdf",fn:g(()=>[p(t.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,t.$slots.optionCsv?{name:"optionCsv",fn:g(()=>[p(t.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,t.$slots.optionImg?{name:"optionImg",fn:g(()=>[p(t.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,t.$slots.optionTable?{name:"optionTable",fn:g(()=>[p(t.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,t.$slots.optionFullscreen?{name:"optionFullscreen",fn:g(({toggleFullscreen:l,isFullscreen:o})=>[p(t.$slots,"optionFullscreen",F(L({toggleFullscreen:l,isFullscreen:o})),void 0,!0)]),key:"5"}:void 0,t.$slots.optionAnnotator?{name:"optionAnnotator",fn:g(({toggleAnnotator:l,isAnnotator:o})=>[p(t.$slots,"optionAnnotator",F(L({toggleAnnotator:l,isAnnotator:o})),void 0,!0)]),key:"6"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasXls","hasImg","hasTable","hasFullscreen","isTooltip","isFullscreen","titles","chartElement","position","hasAnnotator","isAnnotation","onGeneratePdf","onGenerateImage"])):k("",!0),M.value?(r(),y("svg",{key:4,xmlns:i(Ye),class:G({"vue-data-ui-fullscreen--on":I.value,"vue-data-ui-fulscreen--off":!I.value}),viewBox:`0 0 ${n.value.width<=0?10:n.value.width} ${n.value.height<=0?10:n.value.height}`,style:V(`max-width:100%;overflow:visible;background:transparent;color:${e.value.style.chart.color}`)},[fe(dt),$("defs",null,[(r(!0),y(be,null,ke(d.value,(l,o)=>(r(),y("radialGradient",{cx:"50%",cy:"30%",r:"50%",fx:"50%",fy:"50%",id:`gradient_${O.value}_${o}`},[$("stop",{offset:"0%","stop-color":i(Ze)(i(Qe)(l.color,.05),100-e.value.style.chart.layout.rings.gradient.intensity)},null,8,ft),$("stop",{offset:"100%","stop-color":l.color},null,8,bt)],8,mt))),256))]),(r(!0),y(be,null,ke(d.value,(l,o)=>(r(),y("g",null,[$("circle",{class:G({"vue-ui-rings-item":A.value&&e.value.useCssAnimation,"vue-rings-item-onload":!A.value&&e.value.useCssAnimation,"vue-ui-rings-opacity":x.value!==null&&x.value!==o}),style:V(`animation-delay:${o*100}ms`),stroke:e.value.style.chart.layout.rings.stroke,cx:n.value.width/2,cy:o===0?n.value.height/2:n.value.height/2+h.value*d.value[0].proportion/2-h.value*l.proportion/2-2*(o+1),r:i(J)(h.value*l.proportion/2*.9<=0?1e-4:h.value*l.proportion/2*.9),fill:e.value.style.chart.layout.rings.gradient.underlayerColor},null,14,kt),$("circle",{class:G({"vue-ui-rings-item":A.value&&e.value.useCssAnimation,"vue-rings-item-onload":!A.value&&e.value.useCssAnimation,"vue-ui-rings-shadow":e.value.style.chart.layout.rings.useShadow,"vue-ui-rings-blur":x.value!==null&&x.value!==o}),style:V(`animation-delay:${o*100}ms`),stroke:e.value.style.chart.layout.rings.stroke,"stroke-width":l.strokeWidth<.5?.5:l.strokeWidth,cx:n.value.width/2,cy:o===0?n.value.height/2:n.value.height/2+h.value*d.value[0].proportion/2-h.value*l.proportion/2-2*(o+1),r:i(J)(h.value*l.proportion/2*.9<=0?1e-4:h.value*l.proportion/2*.9),fill:e.value.style.chart.layout.rings.gradient.show?`url(#gradient_${O.value}_${o})`:l.color},null,14,$t),$("circle",{"data-cy-trap":"",stroke:"none",cx:n.value.width/2,cy:o===0?n.value.height/2:n.value.height/2+h.value*d.value[0].proportion/2-h.value*l.proportion/2-2*(o+1),r:i(J)(h.value*l.proportion/2*.9<=0?1e-4:h.value*l.proportion/2*.9),fill:"transparent",onMouseenter:s=>Le(o,l),onMouseleave:a[0]||(a[0]=s=>{x.value=null,B.value=!1})},null,40,wt)]))),256)),p(t.$slots,"svg",{svg:n.value},void 0,!0)],14,yt)):k("",!0),t.$slots.watermark?(r(),y("div",Ct,[p(t.$slots,"watermark",F(L({isPrinting:i(ue)||i(re)})),void 0,!0)])):k("",!0),M.value?k("",!0):(r(),N(vt,{key:6,config:{type:"rings",style:{backgroundColor:e.value.style.chart.backgroundColor,rings:{color:"#CCCCCC"}}}},null,8,["config"])),$("div",{ref_key:"chartLegend",ref:Z},[e.value.style.chart.legend.show?(r(),N(it,{key:`legend_${ae.value}`,legendSet:de.value,config:Se.value,onClickMarker:a[1]||(a[1]=({legend:l})=>D(l.uid))},{item:g(({legend:l,index:o})=>[$("div",{"data-cy-legend-item":"",onClick:s=>D(l.uid),style:V(`opacity:${c.value.includes(l.uid)?.5:1}`)},[we(H(l.name)+": "+H(i($e)(e.value.style.chart.layout.labels.dataLabels.formatter,l.value,i(_)({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:l.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.legend.roundingValue}),{datapoint:l,seriesIndex:o}))+" ",1),c.value.includes(l.uid)?(r(),y("span",_t," ( - % ) ")):(r(),y("span",Tt," ("+H(isNaN(l.value/f.value)?"-":i(_)({v:l.value/f.value*100,s:"%",r:e.value.style.chart.legend.roundingPercentage}))+") ",1))],12,xt)]),_:1},8,["legendSet","config"])):p(t.$slots,"legend",{key:1,legend:de.value},void 0,!0)],512),t.$slots.source?(r(),y("div",{key:7,ref_key:"source",ref:Q,dir:"auto"},[p(t.$slots,"source",{},void 0,!0)],512)):k("",!0),fe(rt,{show:w.value.showTooltip&&B.value&&c.value.length<m.dataset.length,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,fontSize:e.value.style.chart.tooltip.fontSize,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:P.value,content:j.value,isCustom:e.value.style.chart.tooltip.customFormat&&typeof e.value.style.chart.tooltip.customFormat=="function"},{"tooltip-before":g(()=>[p(t.$slots,"tooltip-before",F(L({...U.value})),void 0,!0)]),"tooltip-after":g(()=>[p(t.$slots,"tooltip-after",F(L({...U.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","borderRadius","borderColor","borderWidth","fontSize","backgroundOpacity","position","offsetY","parent","content","isCustom"]),M.value?(r(),N(ct,{key:8,hideDetails:"",config:{open:w.value.showTable,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:g(()=>[(r(),N(nt,{key:`table_${le.value}`,colNames:W.value.colNames,head:W.value.head,body:W.value.body,config:W.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:a[2]||(a[2]=l=>w.value.showTable=!1)},{th:g(({th:l})=>[$("div",{innerHTML:l,style:{display:"flex","align-items":"center"}},null,8,Nt)]),td:g(({td:l})=>[we(H(l.name||l),1)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):k("",!0)],46,ht))}},Ht=pt(Pt,[["__scopeId","data-v-2a4f4cb4"]]);export{Ht as default};
