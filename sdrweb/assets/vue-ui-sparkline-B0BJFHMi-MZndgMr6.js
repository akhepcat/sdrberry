import{z as re,c as d,r as k,D as ie,H as ve,aF as B,w as Z,B as ne,C as q,Z as de,b as ye,a1 as C,aG as he,aH as ce,o as s,a as i,m as G,p as pe,q as fe,M as I,e as p,h as H,L as c,u as y,J as ge,f as ke,O as z,aw as U,P as A,k as j,U as X,G as J,i as xe}from"./index-CMbgrvzv.js";import{c as K}from"./useNestedProp-BxrcwmTZ-DfxG55sS.js";import me from"./vue-ui-skeleton-Dgzcn3FL-nxJtxydg.js";import{O as be,k as we}from"./useResponsive-CoxXLe23-CoJWR8uA.js";import{p as $e}from"./PackageVersion-mSsg8dpu-CbvTnp2w.js";import{s as Le}from"./vue-data-ui-DF7u-eZV-DHaDTFza.js";const _e=["id"],Ne=["xmlns","viewBox"],Ce=["id"],Ie=["stop-color"],ze=["stop-color"],We=["id"],Ve=["stop-color"],Me=["stop-color"],Se=["id"],Be=["stop-color"],Ge=["stop-color"],Ae={key:0},je=["d","fill"],De=["d","fill"],Fe=["d","stroke","stroke-width"],Oe=["x1","x2","y1","y2","stroke","stroke-width"],Ee=["x","y","width","height","fill","rx"],Te=["x1","x2","y1","y2","stroke","stroke-width","stroke-dasharray"],Pe=["x1","x2","y1","y2","stroke","stroke-dasharray","stroke-width"],Re=["cx","cy","r","fill","stroke","stroke-width"],Ze=["x","y","font-size","font-weight","fill"],qe=["x","y","height","width","onMouseenter","onClick"],He={__name:"vue-ui-sparkline",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}},showInfo:{type:Boolean,default:!0},selectedIndex:{type:Number,default:void 0}},emits:["hoverIndex","selectDatapoint"],setup(b,{emit:W}){const v=b,{vue_ui_sparkline:Q}=re(),L=d(()=>!!v.dataset&&v.dataset.length),f=k(ie()),V=k(null),D=k(null),F=k(null),e=d({get:()=>O(),set:l=>l});function O(){const l=K({userConfig:v.config,defaultConfig:Q});return l.theme?{...K({userConfig:ve.vue_ui_sparkline[l.theme]||v.config,defaultConfig:l})}:l}const _=d(()=>B({data:v.dataset,threshold:e.value.downsample.threshold}));Z(()=>v.config,l=>{e.value=O(),T(),t.value.chartWidth=e.value.style.chartWidth},{deep:!0}),Z(()=>v.dataset,l=>{m.value=B({data:v.dataset.map(u=>({...u,value:[void 0].includes(u.value)?null:u.value})),threshold:e.value.downsample.threshold})},{deep:!0});const m=k(Y());function Y(){return B({data:v.dataset.map(l=>e.value.style.animation.show?{...l,value:null}:{...l,value:[void 0].includes(l.value)?null:l.value}),threshold:e.value.downsample.threshold})}const E=k(null);ye(()=>{if(T(),e.value.style.animation.show&&v.dataset.length>1){let l=function(){a<_.value.length?(m.value.push(_.value[a]),setTimeout(()=>{requestAnimationFrame(l)},u)):m.value=_.value,a+=1};m.value=[];const u=e.value.style.animation.animationFrames/v.dataset.length;let a=0;l()}});function T(){if(ne(v.dataset)?q({componentName:"VueUiSparkline",type:"dataset"}):v.dataset.forEach((l,u)=>{de({datasetObject:l,requiredAttributes:["period","value"]}).forEach(a=>{q({componentName:"VueUiSparkline",type:"datasetSerieAttribute",property:a,index:u})})}),e.value.responsive){const l=be(()=>{const{width:u,height:a}=we({chart:V.value,title:e.value.style.title.show&&v.showInfo?D.value:null,source:F.value});t.value.width=u,t.value.height=a,t.value.chartWidth=e.value.style.chartWidth/500*u,t.value.padding=.06*u});E.value=new ResizeObserver(l),E.value.observe(V.value.parentNode)}}const t=k({height:80,width:500,chartWidth:e.value.style.chartWidth,padding:30}),ee=k(6),o=d(()=>({top:12,left:0,right:t.value.width,bottom:t.value.height-3,start:v.showInfo&&e.value.style.dataLabel.show&&e.value.style.dataLabel.position==="left"?t.value.width-t.value.chartWidth:t.value.padding,width:v.showInfo&&e.value.style.dataLabel.show?t.value.chartWidth:t.value.width-t.value.padding,height:t.value.height-12})),M=d(()=>Math.min(...m.value.map(l=>isNaN(l.value)||[void 0,null,"NaN",NaN,1/0,-1/0].includes(l.value)?0:l.value||0))),le=d(()=>Math.max(...m.value.map(l=>isNaN(l.value)||[void 0,null,"NaN",NaN,1/0,-1/0].includes(l.value)?0:l.value||0))),w=d(()=>{const l=M.value>=0?0:M.value;return Math.abs(l)}),ae=d(()=>le.value+w.value+ee.value),N=d(()=>o.value.bottom-o.value.height*S(w.value));function S(l){return l/ae.value}const g=d(()=>_.value.length-1),r=d(()=>m.value.map((l,u)=>{const a=isNaN(l.value)||[void 0,null,"NaN",NaN,1/0,-1/0].includes(l.value)?0:l.value||0;return{absoluteValue:a,period:l.period,plotValue:a+w.value,toMax:S(a+w.value),x:o.value.start+u*(o.value.width/(g.value+1)>t.padding?t.padding:o.value.width/(g.value+1)),y:o.value.bottom-o.value.height*S(a+w.value),id:`plot_${f.value}_${u}`,color:$.value?e.value.style.bar.color:e.value.style.area.useGradient?C(e.value.style.line.color,.05*(1-u/g.value)):e.value.style.line.color,width:o.value.width/(g.value+1)>t.padding?t.padding:o.value.width/(g.value+1)}})),te=d(()=>{const l={x:r.value[0].x,y:t.value.height-6},u={x:r.value[r.value.length-1].x,y:t.value.height-6},a=[];return r.value.forEach(n=>{a.push(`${n.x},${n.y} `)}),[l.x,l.y,...a,u.x,u.y].toString()}),h=k(void 0);function ue(l,u){h.value=l,W("hoverIndex",{index:u})}function oe(){h.value=void 0,W("hoverIndex",{index:void 0})}const x=d(()=>{if(L.value){const l=r.value.map(a=>a.absoluteValue),u=l.reduce((a,n)=>a+n,0);return{latest:r.value[r.value.length-1].absoluteValue,sum:u,average:u/r.value.length,median:ce(l),trend:he(r.value.map(({x:a,y:n,absoluteValue:R})=>({x:a,y:n,value:R}))).trend}}else return{latest:null,sum:null,average:null,median:null,trend:null}}),P=d(()=>L.value?e.value.style.dataLabel.valueType==="latest"?x.value.latest:e.value.style.dataLabel.valueType==="sum"?x.value.sum:e.value.style.dataLabel.valueType==="average"?x.value.average:0:0),$=d(()=>e.value.type&&e.value.type==="bar");function se(l,u){W("selectDatapoint",{datapoint:l,index:u})}return(l,u)=>(s(),i("div",{ref_key:"sparklineChart",ref:V,class:"vue-ui-sparkline",id:f.value,style:I(`width:100%;font-family:${e.value.style.fontFamily}`)},[G(l.$slots,"before",pe(fe({selected:h.value,latest:x.value.latest,sum:x.value.sum,average:x.value.average,median:x.value.median,trend:x.value.trend})),void 0,!0),e.value.style.title.show&&b.showInfo?(s(),i("div",{key:0,ref_key:"chartTitle",ref:D,class:"vue-ui-sparkline-title",style:I(`display:flex;align-items:center;width:100%;color:${e.value.style.title.color};background:${e.value.style.backgroundColor};justify-content:${e.value.style.title.textAlign==="left"?"flex-start":e.value.style.title.textAlign==="right"?"flex-end":"center"};height:${e.value.style.title.fontSize*2}px;font-size:${e.value.style.title.fontSize}px;font-weight:${e.value.style.title.bold?"bold":"normal"};`)},[p("span",{style:I(`padding:${e.value.style.title.textAlign==="left"?"0 0 0 12px":e.value.style.title.textAlign==="right"?"0 12px 0 0":"0"}`)},H(h.value?h.value.period:e.value.style.title.text),5)],4)):c("",!0),L.value?(s(),i("svg",{key:1,xmlns:y(ge),viewBox:`0 0 ${t.value.width} ${t.value.height}`,style:I(`background:${e.value.style.backgroundColor};overflow:visible`)},[ke($e),p("defs",null,[p("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"0%",id:`sparkline_gradient_${f.value}`},[p("stop",{offset:"0%","stop-color":y(z)(y(C)(e.value.style.area.color,.05),e.value.style.area.opacity)},null,8,Ie),p("stop",{offset:"100%","stop-color":y(z)(e.value.style.area.color,e.value.style.area.opacity)},null,8,ze)],8,Ce),p("linearGradient",{x2:"0%",y2:"100%",id:`sparkline_bar_gradient_pos_${f.value}`},[p("stop",{offset:"0%","stop-color":e.value.style.bar.color},null,8,Ve),p("stop",{offset:"100%","stop-color":y(C)(e.value.style.bar.color,.05)},null,8,Me)],8,We),p("linearGradient",{x2:"0%",y2:"100%",id:`sparkline_bar_gradient_neg_${f.value}`},[p("stop",{offset:"0%","stop-color":y(C)(e.value.style.bar.color,.05)},null,8,Be),p("stop",{offset:"100%","stop-color":e.value.style.bar.color},null,8,Ge)],8,Se)]),e.value.style.area.show&&!$.value&&r.value[0]?(s(),i("g",Ae,[e.value.style.line.smooth?(s(),i("path",{key:0,d:`M ${r.value[0].x},${o.value.bottom} ${y(U)(r.value)} L ${r.value.at(-1).x},${o.value.bottom} Z`,fill:e.value.style.area.useGradient?`url(#sparkline_gradient_${f.value})`:y(z)(e.value.style.area.color,e.value.style.area.opacity)},null,8,je)):(s(),i("path",{key:1,d:`M${te.value}Z`,fill:e.value.style.area.useGradient?`url(#sparkline_gradient_${f.value})`:y(z)(e.value.style.area.color,e.value.style.area.opacity)},null,8,De))])):c("",!0),e.value.style.line.smooth&&!$.value?(s(),i("path",{key:1,d:`M ${y(U)(r.value)}`,stroke:e.value.style.line.color,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":"round"},null,8,Fe)):c("",!0),(s(!0),i(A,null,j(r.value,(a,n)=>(s(),i("g",null,[n<r.value.length-1&&!e.value.style.line.smooth&&!$.value?(s(),i("line",{key:0,x1:a.x,x2:r.value[n+1].x,y1:a.y,y2:r.value[n+1].y,stroke:a.color,"stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":"round","stroke-linejoin":"round","shape-rendering":"geometricPrecision"},null,8,Oe)):c("",!0),$.value?(s(),i("rect",{key:1,x:a.x-a.width/2,y:a.absoluteValue>0?a.y:N.value,width:a.width,height:Math.abs(a.y-N.value),fill:a.absoluteValue>0?`url(#sparkline_bar_gradient_pos_${f.value})`:`url(#sparkline_bar_gradient_neg_${f.value})`,rx:e.value.style.bar.borderRadius},null,8,Ee)):c("",!0),e.value.style.verticalIndicator.show&&(h.value&&a.id===h.value.id||b.selectedIndex===n)?(s(),i("line",{key:2,x1:a.x,x2:a.x,y1:o.value.top-6,y2:o.value.bottom,stroke:e.value.style.verticalIndicator.color||a.color,"stroke-width":e.value.style.verticalIndicator.strokeWidth,"stroke-linecap":"round","stroke-dasharray":e.value.style.verticalIndicator.strokeDasharray||0},null,8,Te)):c("",!0)]))),256)),M.value<0?(s(),i("line",{key:2,x1:o.value.start,x2:o.value.start+o.value.width-16,y1:N.value,y2:N.value,stroke:e.value.style.zeroLine.color,"stroke-dasharray":e.value.style.zeroLine.strokeWidth*2,"stroke-width":e.value.style.zeroLine.strokeWidth,"stroke-linecap":"round"},null,8,Pe)):c("",!0),e.value.style.plot.show?(s(!0),i(A,{key:3},j(r.value,(a,n)=>(s(),i("g",null,[h.value&&a.id===h.value.id||b.selectedIndex===n?(s(),i("circle",{key:0,cx:a.x,cy:a.y,r:e.value.style.plot.radius,fill:a.color,stroke:e.value.style.plot.stroke,"stroke-width":e.value.style.plot.strokeWidth},null,8,Re)):c("",!0)]))),256)):c("",!0),b.showInfo&&e.value.style.dataLabel.show?(s(),i("text",{key:4,x:e.value.style.dataLabel.position==="left"?12+e.value.style.dataLabel.offsetX:o.value.width+12+e.value.style.dataLabel.offsetX,y:t.value.height/2+e.value.style.dataLabel.fontSize/2.5+e.value.style.dataLabel.offsetY,"font-size":e.value.style.dataLabel.fontSize,"font-weight":e.value.style.dataLabel.bold?"bold":"normal",fill:e.value.style.dataLabel.color},H(h.value?y(X)(e.value.style.dataLabel.formatter,h.value.absoluteValue,y(J)({p:e.value.style.dataLabel.prefix,v:h.value.absoluteValue,s:e.value.style.dataLabel.suffix,r:e.value.style.dataLabel.roundingValue}),{datapoint:h.value}):y(X)(e.value.style.dataLabel.formatter,P.value,y(J)({p:e.value.style.dataLabel.prefix,v:P.value,s:e.value.style.dataLabel.suffix,r:e.value.style.dataLabel.roundingValue}))),9,Ze)):c("",!0),(s(!0),i(A,null,j(r.value,(a,n)=>(s(),i("rect",{x:a.x-(o.value.width/(g.value+1)>t.value.padding?t.value.padding:o.value.width/(g.value+1))/2,y:o.value.top-6,height:o.value.height+6,width:o.value.width/(g.value+1)>t.value.padding?t.value.padding:o.value.width/(g.value+1),fill:"transparent",onMouseenter:R=>ue(a,n),onMouseleave:oe,onClick:()=>se(a,n)},null,40,qe))),256)),G(l.$slots,"svg",{svg:t.value},void 0,!0)],12,Ne)):c("",!0),l.$slots.source?(s(),i("div",{key:2,ref_key:"source",ref:F,dir:"auto"},[G(l.$slots,"source",{},void 0,!0)],512)):c("",!0),L.value?c("",!0):(s(),xe(me,{key:3,config:{type:"sparkline",style:{backgroundColor:e.value.style.backgroundColor,sparkline:{color:"#CCCCCC"}}}},null,8,["config"]))],12,_e))}},el=Le(He,[["__scopeId","data-v-9467697c"]]);export{el as default};
