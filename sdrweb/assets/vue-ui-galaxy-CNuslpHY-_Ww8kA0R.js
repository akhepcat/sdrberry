import{z as _e,c as d,b as Pe,B as Ne,C as re,Z as Oe,r as u,D as ue,R as Ae,A as F,H as Le,w as Se,E as Fe,ak as ne,Q as Ve,an as Be,G as k,K as Ee,V as We,N as ze,o as s,a as n,i as w,L as i,j as Ge,l as v,m as c,p as P,q as N,u as p,M as H,n as V,J as Me,f as ie,e as C,P as ve,k as ce,a2 as de,a3 as De,U as he,g as pe,h as B}from"./index-DIL_pLmJ.js";import{C as He}from"./Legend-BorSDXCj-Cb5_Z7Gi.js";import{x as Re}from"./Title-DyD-mBPN-CHqvPevn.js";import{E as je}from"./Tooltip-qod9o4Vz-Dsvb9C65.js";import{W as Xe}from"./DataTable-D8fcY_sJ-By-GDpuN.js";import{r as Ye,a as qe}from"./usePrinter-CLcxWv-4-CCDxi2Mm.js";import Je from"./vue-ui-skeleton-Dgzcn3FL-BNvPX0g2.js";import Ke from"./vue-ui-accordion-m8rut1bP-DBR24duA.js";import{c as ye}from"./useNestedProp-BxrcwmTZ-1Bk3HyKT.js";import{p as Qe}from"./PackageVersion-mSsg8dpu-BxnQ4_xj.js";import{S as Ze}from"./PenAndPaper-Dk41ZrJ0-D5uht0-m.js";import{s as Ue}from"./vue-data-ui-DF7u-eZV-hcmE5A1B.js";import"./Shape-DYFnvMNd-DLTmTYE_.js";const et=["id"],tt={key:1,ref:"noTitle",class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},at={key:2,style:"width:100%;background:transparent;padding-bottom:24px"},lt=["xmlns","viewBox"],ot=["id"],st=["stdDeviation"],rt=["d","stroke","stroke-width"],ut=["d","stroke","stroke-width"],nt=["filter"],it=["d","stroke","stroke-width"],vt=["d","stroke-width","onMouseenter","onClick"],ct={key:5,class:"vue-data-ui-watermark"},dt=["onClick"],ht={key:0},pt={key:1},yt={key:8,ref:"source",dir:"auto"},gt=["innerHTML"],ft={__name:"vue-ui-galaxy",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectLegend","selectDatapoint"],setup(ge,{expose:fe,emit:R}){const y=ge,{vue_ui_galaxy:be}=_e(),O=d(()=>!!y.dataset&&y.dataset.length);Pe(()=>{j()});function j(){Ne(y.dataset)?re({componentName:"VueUiGalaxy",type:"dataset"}):y.dataset.forEach((t,l)=>{Oe({datasetObject:t,requiredAttributes:["name","values"]}).forEach(a=>{re({componentName:"VueUiGalaxy",type:"datasetSerieAttribute",property:a,index:l})})})}const $=u(ue()),A=u(null),me=u(null),E=u(!1),W=u(""),g=u(null),X=u(0),Y=u(0),q=u(0),J=u(0),e=d({get:()=>K(),set:t=>t});function K(){const t=ye({userConfig:y.config,defaultConfig:be});return t.theme?{...ye({userConfig:Le.vue_ui_galaxy[t.theme]||y.config,defaultConfig:t}),customPalette:Ae[t.theme]||F}:t}Se(()=>y.config,t=>{e.value=K(),j(),Y.value+=1,q.value+=1,J.value+=1},{deep:!0});const{isPrinting:Q,isImaging:Z,generatePdf:U,generateImage:ee}=Ye({elementId:`galaxy_${$.value}`,fileName:e.value.style.chart.title.text||"vue-ui-galaxy"}),ke=d(()=>e.value.userOptions.show&&!e.value.style.chart.title.text),xe=d(()=>Fe(e.value.customPalette)),b=u({dataLabels:{show:e.value.style.chart.layout.labels.dataLabels.show},showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}),z=u({height:180,width:250}),h=u([]);function G(t){h.value.includes(t.id)?h.value=h.value.filter(l=>l!==t.id):h.value.push(t.id),R("selectLegend",T.value.map(l=>({name:l.name,color:l.color,value:l.value})))}const x=d(()=>y.dataset.map((t,l)=>({name:t.name,color:Ve(t.color)||xe.value[l]||F[l]||F[l%F.length],value:t.values?ne(t.values).reduce((a,o)=>a+o,0):0,absoluteValues:ne(t.values),id:ue(),seriesIndex:l})).sort((t,l)=>l.value-t.value));function we(){return x.value.map(t=>({name:t.name,color:t.color,value:t.value}))}const f=d(()=>x.value.filter(t=>!h.value.includes(t.id)).map(t=>t.value).reduce((t,l)=>t+l,0)),Ce=u(190),te=d(()=>x.value.filter(t=>!h.value.includes(t.id))),T=d(()=>{const t=[];for(let l=0;l<te.value.length;l+=1){const a=te.value[l];let o=a.value/f.value*Ce.value;l>0&&t.length&&(o+=t[l-1].points),t.push({points:o,...a,seriesIndex:l,proportion:a.value/f.value,path:Be({points:o,startX:115+e.value.style.chart.layout.arcs.offsetX,startY:90+e.value.style.chart.layout.arcs.offsetY})})}return t.filter((l,a)=>!h.value.includes(l.id)).toSorted((l,a)=>a.points-l.points)}),I=u(!1);function $e(t){I.value=t,X.value+=1}const M=u(null);function Te({datapoint:t,_relativeIndex:l,seriesIndex:a,show:o=!1}){M.value={datapoint:t,seriesIndex:a,series:x.value,config:e.value},E.value=o,g.value=t.id;let r="";const _=e.value.style.chart.tooltip.customFormat;de(_)&&De(()=>_({seriesIndex:a,datapoint:t,series:x.value,config:e.value}))?W.value=_({seriesIndex:a,datapoint:t,series:x.value,config:e.value}):(r+=`<div style="width:100%;text-align:center;border-bottom:1px solid ${e.value.style.chart.tooltip.borderColor};padding-bottom:6px;margin-bottom:3px;">${t.name}</div>`,r+=`<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="${t.color}"/></svg>`,e.value.style.chart.tooltip.showValue&&(r+=`<b>${he(e.value.style.chart.layout.labels.dataLabels.formatter,t.value,k({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:t.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.tooltip.roundingValue}),{datapoint:t,seriesIndex:a})}</b>`),e.value.style.chart.tooltip.showPercentage&&(e.value.style.chart.tooltip.showValue?r+=`<span>(${k({v:t.proportion*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})})</span></div>`:r+=`<b>${k({v:t.proportion*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})}</b></div>`),W.value=`<div>${r}</div>`)}const ae=d(()=>x.value.map((t,l)=>({...t,proportion:(t.value||0)/y.dataset.map(a=>(a.values||[]).reduce((o,r)=>o+r,0)).reduce((a,o)=>a+o,0),opacity:h.value.includes(t.id)?.5:1,shape:t.shape||"circle",segregate:()=>G(t),isSegregated:h.value.includes(t.id)}))),Ie=d(()=>({cy:"galaxy-div-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:e.value.style.chart.legend.bold?"bold":""})),m=d(()=>{const t=T.value.map(a=>({name:a.name,color:a.color})),l=T.value.map(a=>a.value);return{head:t,body:l}});function le(){Ee(()=>{const t=m.value.head.map((o,r)=>[[o.name],[m.value.body[r]],[isNaN(m.value.body[r]/f.value)?"-":m.value.body[r]/f.value*100]]),l=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[""],["val"],["%"]]].concat(t),a=We(l);ze({csvContent:a,title:e.value.style.chart.title.text||"vue-ui-galaxy"})})}const L=d(()=>{const t=[' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>',k({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:f.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue}),"100%"],l=m.value.head.map((o,r)=>{const _=k({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:m.value.body[r],s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue});return[{color:o.color,name:o.name},_,isNaN(m.value.body[r]/f.value)?"-":k({v:m.value.body[r]/f.value*100,s:"%",r:e.value.table.td.roundingPercentage})]}),a={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint};return{colNames:[e.value.table.columnNames.series,e.value.table.columnNames.value,e.value.table.columnNames.percentage],head:t,body:l,config:a}});function oe(){b.value.showTable=!b.value.showTable}function se(){b.value.showTooltip=!b.value.showTooltip}const S=u(!1);function D(){S.value=!S.value}return fe({getData:we,generatePdf:U,generateCsv:le,generateImage:ee,toggleTable:oe,toggleTooltip:se,toggleAnnotator:D}),(t,l)=>(s(),n("div",{ref_key:"galaxyChart",ref:A,class:V(`vue-ui-galaxy ${I.value?"vue-data-ui-wrapper-fullscreen":""} ${e.value.useCssAnimation?"":"vue-ui-dna"}`),style:H(`font-family:${e.value.style.fontFamily};width:100%; text-align:center;${e.value.style.chart.title.text?"":"padding-top:36px"};background:${e.value.style.chart.backgroundColor}`),id:`galaxy_${$.value}`},[e.value.userOptions.buttons.annotator?(s(),w(Ze,{key:0,parent:A.value,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,active:S.value,onClose:D},null,8,["parent","backgroundColor","color","active"])):i("",!0),ke.value?(s(),n("div",tt,null,512)):i("",!0),e.value.style.chart.title.text?(s(),n("div",at,[(s(),w(Re,{key:`title_${Y.value}`,config:{title:{cy:"galaxy-div-title",...e.value.style.chart.title},subtitle:{cy:"galaxy-div-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))])):i("",!0),e.value.userOptions.show&&O.value?(s(),w(qe,{ref_key:"details",ref:me,key:`user_option_${X.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:p(Q),isImaging:p(Z),uid:$.value,hasTooltip:e.value.userOptions.buttons.tooltip&&e.value.style.chart.tooltip.show,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isTooltip:b.value.showTooltip,isFullscreen:I.value,titles:{...e.value.userOptions.buttonTitles},chartElement:A.value,position:e.value.userOptions.position,hasAnnotator:e.value.userOptions.buttons.annotator,isAnnotation:S.value,onToggleFullscreen:$e,onGeneratePdf:p(U),onGenerateCsv:le,onGenerateImage:p(ee),onToggleTable:oe,onToggleTooltip:se,onToggleAnnotator:D},Ge({_:2},[t.$slots.optionTooltip?{name:"optionTooltip",fn:v(()=>[c(t.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,t.$slots.optionPdf?{name:"optionPdf",fn:v(()=>[c(t.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,t.$slots.optionCsv?{name:"optionCsv",fn:v(()=>[c(t.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,t.$slots.optionImg?{name:"optionImg",fn:v(()=>[c(t.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,t.$slots.optionTable?{name:"optionTable",fn:v(()=>[c(t.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,t.$slots.optionFullscreen?{name:"optionFullscreen",fn:v(({toggleFullscreen:a,isFullscreen:o})=>[c(t.$slots,"optionFullscreen",P(N({toggleFullscreen:a,isFullscreen:o})),void 0,!0)]),key:"5"}:void 0,t.$slots.optionAnnotator?{name:"optionAnnotator",fn:v(({toggleAnnotator:a,isAnnotator:o})=>[c(t.$slots,"optionAnnotator",P(N({toggleAnnotator:a,isAnnotator:o})),void 0,!0)]),key:"6"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasXls","hasImg","hasTable","hasFullscreen","isTooltip","isFullscreen","titles","chartElement","position","hasAnnotator","isAnnotation","onGeneratePdf","onGenerateImage"])):i("",!0),O.value?(s(),n("svg",{key:4,xmlns:p(Me),class:V({"vue-data-ui-fullscreen--on":I.value,"vue-data-ui-fulscreen--off":!I.value}),viewBox:`0 0 ${z.value.width} ${z.value.height}`,style:H(`max-width:100%; overflow: visible; background:transparent;color:${e.value.style.chart.color}`)},[ie(Qe),C("defs",null,[C("filter",{id:`blur_${$.value}`,x:"-50%",y:"-50%",width:"200%",height:"200%"},[C("feGaussianBlur",{in:"SourceGraphic",stdDeviation:100/e.value.style.chart.layout.arcs.gradient.intensity},null,8,st)],8,ot)]),(s(!0),n(ve,null,ce(T.value,a=>(s(),n("g",null,[a.value?(s(),n("path",{key:0,d:a.path,fill:"none",stroke:e.value.style.chart.backgroundColor,"stroke-width":(e.value.style.chart.layout.arcs.strokeWidth+e.value.style.chart.layout.arcs.borderWidth)*(g.value===a.id&&e.value.style.chart.layout.arcs.hoverEffect.show?e.value.style.chart.layout.arcs.hoverEffect.multiplicator:1),"stroke-linecap":"round"},null,8,rt)):i("",!0),a.value?(s(),n("path",{key:1,d:a.path,fill:"none",stroke:a.color,"stroke-width":e.value.style.chart.layout.arcs.strokeWidth*(g.value===a.id&&e.value.style.chart.layout.arcs.hoverEffect.show?e.value.style.chart.layout.arcs.hoverEffect.multiplicator:1),"stroke-linecap":"round",class:V(`${g.value&&g.value!==a.id&&e.value.useBlurOnHover?"vue-ui-galaxy-blur":""}`)},null,10,ut)):i("",!0),a.value&&e.value.style.chart.layout.arcs.gradient.show?(s(),n("g",{key:2,filter:`url(#blur_${$.value})`},[C("path",{d:a.path,fill:"none",stroke:e.value.style.chart.layout.arcs.gradient.color,"stroke-width":e.value.style.chart.layout.arcs.strokeWidth/2*(g.value===a.id&&e.value.style.chart.layout.arcs.hoverEffect.show?e.value.style.chart.layout.arcs.hoverEffect.multiplicator:1),"stroke-linecap":"round",class:V(`vue-ui-galaxy-gradient ${g.value&&g.value!==a.id&&e.value.useBlurOnHover?"vue-ui-galaxy-blur":""}`)},null,10,it)],8,nt)):i("",!0)]))),256)),(s(!0),n(ve,null,ce(T.value,(a,o)=>(s(),n("g",null,[a.value?(s(),n("path",{key:0,d:a.path,fill:"none",stroke:"transparent","stroke-width":e.value.style.chart.layout.arcs.strokeWidth+e.value.style.chart.layout.arcs.borderWidth,"stroke-linecap":"round",onMouseenter:r=>Te({datapoint:a,seriesIndex:a.seriesIndex,show:!0}),onMouseleave:l[0]||(l[0]=r=>{E.value=!1,g.value=null}),onClick:r=>R("selectDatapoint",a)},null,40,vt)):i("",!0)]))),256)),c(t.$slots,"svg",{svg:z.value},void 0,!0)],14,lt)):i("",!0),t.$slots.watermark?(s(),n("div",ct,[c(t.$slots,"watermark",P(N({isPrinting:p(Q)||p(Z)})),void 0,!0)])):i("",!0),O.value?i("",!0):(s(),w(Je,{key:6,config:{type:"galaxy",style:{backgroundColor:e.value.style.chart.backgroundColor,galaxy:{color:"#CCCCCC"}}}},null,8,["config"])),e.value.style.chart.legend.show?(s(),w(He,{key:`legend_${J.value}`,legendSet:ae.value,config:Ie.value,onClickMarker:l[1]||(l[1]=({legend:a})=>G(a))},{item:v(({legend:a,index:o})=>[C("div",{onClick:r=>G(a),style:H(`opacity:${h.value.includes(a.id)?.5:1}`)},[pe(B(a.name)+": "+B(p(he)(e.value.style.chart.layout.labels.dataLabels.formatter,a.value,p(k)({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:a.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.legend.roundingValue}),{datapoint:a,seriesIndex:o}))+" ",1),h.value.includes(a.id)?(s(),n("span",pt," ( - % ) ")):(s(),n("span",ht," ("+B(isNaN(a.value/f.value)?"-":p(k)({v:a.value/f.value*100,s:"%",r:e.value.style.chart.legend.roundingPercentage}))+") ",1))],12,dt)]),_:1},8,["legendSet","config"])):i("",!0),c(t.$slots,"legend",{legend:ae.value},void 0,!0),t.$slots.source?(s(),n("div",yt,[c(t.$slots,"source",{},void 0,!0)],512)):i("",!0),ie(je,{show:b.value.showTooltip&&E.value,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,fontSize:e.value.style.chart.tooltip.fontSize,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:A.value,content:W.value,isCustom:p(de)(e.value.style.chart.tooltip.customFormat)},{"tooltip-before":v(()=>[c(t.$slots,"tooltip-before",P(N({...M.value})),void 0,!0)]),"tooltip-after":v(()=>[c(t.$slots,"tooltip-after",P(N({...M.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","borderRadius","borderColor","borderWidth","fontSize","backgroundOpacity","position","offsetY","parent","content","isCustom"]),O.value?(s(),w(Ke,{key:9,hideDetails:"",config:{open:b.value.showTable,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:v(()=>[(s(),w(Xe,{key:`table_${q.value}`,colNames:L.value.colNames,head:L.value.head,body:L.value.body,config:L.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:l[2]||(l[2]=a=>b.value.showTable=!1)},{th:v(({th:a})=>[C("div",{innerHTML:a,style:{display:"flex","align-items":"center"}},null,8,gt)]),td:v(({td:a})=>[pe(B(a.name||a),1)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):i("",!0)],14,et))}},At=Ue(ft,[["__scopeId","data-v-9e3163ed"]]);export{At as default};
