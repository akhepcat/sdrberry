import{z as se,c as m,r as v,D as Y,R as ie,A as u,H as re,w as G,B as ne,C as H,Z as ue,Q as A,E as de,b as ve,G as L,o as s,a as i,M as c,e as p,h as w,L as f,u as C,J as ce,f as J,P as $,k as _,O as pe,a1 as ge,n as I,a2 as ye,U as T,i as he,l as Z,m as M,p as Q,q as X}from"./index-DIL_pLmJ.js";import{c as K}from"./useNestedProp-BxrcwmTZ-1Bk3HyKT.js";import fe from"./vue-ui-skeleton-Dgzcn3FL-BNvPX0g2.js";import{p as me}from"./PackageVersion-mSsg8dpu-BxnQ4_xj.js";import{E as ke}from"./Tooltip-qod9o4Vz-Dsvb9C65.js";import{s as be}from"./vue-data-ui-DF7u-eZV-hcmE5A1B.js";const xe=["xmlns","viewBox"],we=["id"],Ce=["stop-color"],$e=["stop-color"],_e=["stop-color"],Se={id:"stackPill",clipPathUnits:"objectBoundingBox"},ze=["fill"],Be={key:0,"clip-path":"url(#stackPill)"},Pe=["x","width","height","fill"],Ae=["x","width","height","fill","stroke"],Ie=["onClick","x","width","height","onMouseenter"],Ne=["width","height","rx"],Oe=["onClick"],je={style:{display:"flex","flex-direction":"row","align-items":"center",gap:"4px","justify-content":"center"}},De=["height","width"],Le=["fill"],Me={key:4,ref:"source",dir:"auto"},Ee={__name:"vue-ui-sparkstackbar",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectDatapoint"],setup(ee,{emit:te}){const n=ee,{vue_ui_sparkstackbar:le}=se(),E=m(()=>!!n.dataset&&n.dataset.length),R=v(null),V=v(Y()),N=v(!1),O=v(""),e=m({get:()=>F(),set:t=>t});function F(){const t=K({userConfig:n.config,defaultConfig:le});return t.theme?{...K({userConfig:re.vue_ui_sparkstackbar[t.theme]||n.config,defaultConfig:t}),customPalette:ie[t.theme]||u}:t}G(()=>n.config,t=>{e.value=F(),U()},{deep:!0}),G(()=>n.dataset,t=>{k.value=n.dataset.map((a,l)=>({...a,color:a.color?A(a.color):S.value[l]||u[l]||u[l%u.length]}))},{deep:!0});const S=m(()=>de(e.value.customPalette)),k=v(n.dataset.map((t,a)=>({...t,value:e.value.style.animation.show?0:t.value||0,color:t.color?A(t.color):S.value[a]||u[a]||u[a%u.length]}))),x=v(!0);ve(()=>{if(U(),e.value.style.animation.show){let t=function(){h+=o/a,h<o?(k.value=k.value.map((r,d)=>({...r,value:r.value+=l[d],color:r.color?A(r.color):S.value[d]||u[d]||u[d%u.length]})),requestAnimationFrame(t)):(x.value=!1,k.value=n.dataset.map((r,d)=>({...r,value:r.value||0,color:r.color?A(r.color):S.value[d]||u[d]||u[d%u.length],id:Y()})))};const a=e.value.style.animation.animationFrames,l=n.dataset.map((r,d)=>r.value/a),o=n.dataset.map(r=>r.value||0).reduce((r,d)=>r+d,0);let h=0;x.value=!0,t()}});function U(){ne(n.dataset)?H({componentName:"VueUiSparkStackbar",type:"dataset"}):n.dataset.forEach((t,a)=>{ue({datasetObject:t,requiredAttributes:["name","value"]}).forEach(l=>{H({componentName:"VueUiSparkStackbar",type:"datasetSerieAttribute",property:l,index:a})})})}const g=v({width:500,height:16}),y=v([]),q=m(()=>n.dataset.map(t=>t.value||0).filter((t,a)=>!y.value.includes(a)).reduce((t,a)=>t+a,0)),z=m(()=>k.value.map((t,a)=>{const l=t.value||0,o=l/q.value,h=isNaN(o)?0:o,r=h*g.value.width;return{...t,value:l,proportion:h,width:r,proportionLabel:L({v:h*100,s:"%",r:e.value.style.legend.percentage.rounding})}})),j=m(()=>z.value.filter((t,a)=>!y.value.includes(a)));function ae(t){y.value.includes(t)?y.value=y.value.filter(a=>a!==t):y.value.length<k.value.length-1&&y.value.push(t)}const B=m(()=>{let t=0;const a=[];for(let l=0;l<j.value.length;l+=1)a.push({...j.value[l],start:t}),t+=j.value[l].width;return a});function W(t,a){te("selectDatapoint",{datapoint:t,index:a})}const D=v(null),P=v(!1),b=v(null);function oe({datapoint:t,seriesIndex:a}){if(!e.value.style.tooltip.show)return;D.value={datapoint:t,seriesIndex:a,config:e.value,series:z.value},N.value=!0,b.value=a;const l=e.value.style.tooltip.customFormat;if(ye(l))try{const o=l({seriesIndex:a,datapoint:t,series:z.value,config:e.value});typeof o=="string"&&(O.value=o,P.value=!0)}catch{console.warn("Custom format cannot be applied."),P.value=!1}if(!P.value){let o="";o+=`<div style="width:100%;text-align:center;border-bottom:1px solid ${e.value.style.tooltip.borderColor};padding-bottom:6px;margin-bottom:3px;">${t.name}</div>`,o+=`<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="${t.color}"/></svg>`,o+=`<b>${t.proportionLabel}</b>`,o+=`<span>(${T(e.value.style.legend.value.formatter,t.value,L({p:e.value.style.legend.value.prefix,v:t.value,s:e.value.style.legend.value.suffix,r:e.value.style.legend.value.rounding}),{datapoint:t,seriesIndex:a})})</span>`,O.value=`<div>${o}</div>`}}return(t,a)=>(s(),i("div",{ref_key:"sparkstackbarChart",ref:R,style:c(`width:100%; background:${e.value.style.backgroundColor}`)},[e.value.style.title.text?(s(),i("div",{key:0,style:c(`width:calc(100% - 12px);background:transparent;margin:0 auto;margin:${e.value.style.title.margin};padding: 0 6px;text-align:${e.value.style.title.textAlign}`)},[p("div",{style:c(`font-size:${e.value.style.title.fontSize}px;color:${e.value.style.title.color};font-weight:${e.value.style.title.bold?"bold":"normal"}`)},w(e.value.style.title.text),5),e.value.style.title.subtitle.text?(s(),i("div",{key:0,style:c(`font-size:${e.value.style.title.subtitle.fontSize}px;color:${e.value.style.title.subtitle.color};font-weight:${e.value.style.title.subtitle.bold?"bold":"normal"}`)},w(e.value.style.title.subtitle.text),5)):f("",!0)],4)):f("",!0),E.value?(s(),i("svg",{key:1,xmlns:C(ce),width:"100%",viewBox:`0 0 ${g.value.width} ${g.value.height}`},[J(me),p("defs",null,[(s(!0),i($,null,_(B.value,(l,o)=>(s(),i("linearGradient",{key:`stack_gradient_${o}`,gradientTransform:"rotate(90)",id:`stack_gradient_${o}_${V.value}`},[p("stop",{offset:"0%","stop-color":l.color},null,8,Ce),p("stop",{offset:"50%","stop-color":C(pe)(C(ge)(l.color,.05),100-e.value.style.bar.gradient.intensity)},null,8,$e),p("stop",{offset:"100%","stop-color":l.color},null,8,_e)],8,we))),128)),p("clipPath",Se,[p("rect",{x:"0.005",y:"-2",width:"0.99",height:"5",rx:"3",ry:"3",fill:e.value.style.backgroundColor},null,8,ze)])]),q.value>0?(s(),i("g",Be,[(s(!0),i($,null,_(B.value,(l,o)=>(s(),i("rect",{key:`stack_underlayer_${o}`,x:l.start,y:0,width:l.width,height:g.value.height,fill:e.value.style.bar.gradient.underlayerColor,class:I({animated:!x.value}),style:c({opacity:b.value!==null&&e.value.style.tooltip.show?b.value===o?1:.5:1})},null,14,Pe))),128)),(s(!0),i($,null,_(B.value,(l,o)=>(s(),i("rect",{key:`stack_${o}`,x:l.start,y:0,width:l.width,height:g.value.height,fill:e.value.style.bar.gradient.show?`url(#stack_gradient_${o}_${V.value})`:l.color,stroke:e.value.style.backgroundColor,"stroke-linecap":"round",class:I({animated:!x.value}),style:c({opacity:b.value!==null&&e.value.style.tooltip.show?b.value===o?1:.5:1})},null,14,Ae))),128)),(s(!0),i($,null,_(B.value,(l,o)=>(s(),i("rect",{key:`stack_trap_${o}`,onClick:()=>W(l,o),x:l.start,y:0,width:l.width,height:g.value.height,fill:"transparent",stroke:"none",class:I({animated:!x.value}),onMouseenter:()=>oe({datapoint:l,seriesIndex:o}),onMouseleave:a[0]||(a[0]=h=>{N.value=!1,b.value=null})},null,42,Ie))),128))])):(s(),i("rect",{key:1,x:2,y:1,width:g.value.width-4,height:g.value.height-2,stroke:"#CCCCCC","stroke-width":"2",fill:"transparent",rx:(g.value.height-4)/2},null,8,Ne))],8,xe)):f("",!0),E.value?f("",!0):(s(),he(fe,{key:2,config:{type:"sparkStackbar",style:{backgroundColor:e.value.style.backgroundColor,sparkStackbar:{color:"#CCCCCC"}}}},null,8,["config"])),e.value.style.legend.show?(s(),i("div",{key:3,style:c(`background:transparent;margin:0 auto;margin:${e.value.style.legend.margin};justify-content:${e.value.style.legend.textAlign==="left"?"flex-start":e.value.style.legend.textAlign==="right"?"flex-end":"center"}`),class:"vue-ui-sparkstackbar-legend"},[(s(!0),i($,null,_(z.value,(l,o)=>(s(),i("div",{style:c(`font-size:${e.value.style.legend.fontSize}px;`),class:I({"vue-ui-sparkstackbar-legend-item":!0,"vue-ui-sparkstackbar-legend-item-unselected":y.value.includes(o)}),onClick:h=>{ae(o),W(l,o)}},[p("div",je,[(s(),i("svg",{height:`${e.value.style.legend.fontSize}px`,width:`${e.value.style.legend.fontSize}px`,viewBox:"0 0 10 10"},[p("circle",{cx:5,cy:5,r:5,fill:l.color},null,8,Le)],8,De)),p("span",{style:c(`color:${e.value.style.legend.name.color}; font-weight:${e.value.style.legend.name.bold?"bold":"normal"}`)},w(l.name),5),e.value.style.legend.percentage.show?(s(),i("span",{key:0,style:c(`font-weight:${e.value.style.legend.percentage.bold?"bold":"normal"};color:${e.value.style.legend.percentage.color}`)},w(y.value.includes(o)?" - ":l.proportionLabel),5)):f("",!0),e.value.style.legend.value.show?(s(),i("span",{key:1,style:c(`font-weight:${e.value.style.legend.value.bold?"bold":"normal"};color:${e.value.style.legend.value.color}`)}," ("+w(C(T)(e.value.style.legend.value.formatter,l.value,C(L)({p:e.value.style.legend.value.prefix,v:l.value,s:e.value.style.legend.value.suffix,r:e.value.style.legend.value.rounding}),{datapoint:l,seriesIndex:o}))+") ",5)):f("",!0)])],14,Oe))),256))],4)):f("",!0),J(ke,{show:N.value&&e.value.style.tooltip.show,parent:R.value,backgroundColor:e.value.style.tooltip.backgroundColor,color:e.value.style.tooltip.color,fontSize:e.value.style.tooltip.fontSize,borderRadius:e.value.style.tooltip.borderRadius,borderColor:e.value.style.tooltip.borderColor,borderWidth:e.value.style.tooltip.borderWidth,backgroundOpacity:e.value.style.tooltip.backgroundOpacity,position:e.value.style.tooltip.position,content:O.value,isCustom:P.value,offsetY:-124+e.value.style.tooltip.offsetY,blockShiftY:!0},{"tooltip-before":Z(()=>[M(t.$slots,"tooltip-before",Q(X({...D.value})),void 0,!0)]),"tooltip-after":Z(()=>[M(t.$slots,"tooltip-after",Q(X({...D.value})),void 0,!0)]),_:3},8,["show","parent","backgroundColor","color","fontSize","borderRadius","borderColor","borderWidth","backgroundOpacity","position","content","isCustom","offsetY"]),t.$slots.source?(s(),i("div",Me,[M(t.$slots,"source",{},void 0,!0)],512)):f("",!0)],4))}},Ye=be(Ee,[["__scopeId","data-v-233900f7"]]);export{Ye as default};
