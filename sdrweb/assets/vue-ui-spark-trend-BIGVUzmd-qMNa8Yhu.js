import{z as P,c as s,r as k,D as X,H as Y,aD as T,w as q,B as K,C as Q,b as ee,a0 as h,aE as le,o as u,a as n,u as y,J as ae,f as te,e as b,O as j,aw as D,L as d,i as $,h as E,G,U as oe,m as ue,M as se}from"./index-CMbgrvzv.js";import{c as H}from"./useNestedProp-BxrcwmTZ-DfxG55sS.js";import{s as ne,u as M}from"./vue-data-ui-DF7u-eZV-DHaDTFza.js";import ie from"./vue-ui-skeleton-Dgzcn3FL-nxJtxydg.js";import{p as re}from"./PackageVersion-mSsg8dpu-CbvTnp2w.js";const ve=["id"],de=["xmlns","viewBox"],ye=["id"],he=["stop-color"],pe=["stop-color"],ce={key:0},ge=["d","fill"],fe=["d","fill"],me=["d","stroke","stroke-width","stroke-linecap","stroke-linejoin"],ke=["d","stroke","stroke-width","stroke-linecap","stroke-linejoin"],be=["height","width","x"],we={style:{width:"100%"}},xe=["x","y","fill","font-size","font-weight"],Le=["stroke","cx","cy","fill"],Ce=["x","y","font-size","fill","font-weight"],$e={key:2,ref:"source",dir:"auto"},ze={__name:"vue-ui-spark-trend",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},setup(O){const i=O,{vue_ui_spark_trend:W}=P(),J=s(()=>!!i.dataset&&i.dataset.length),w=k(X()),e=s({get:()=>S(),set:l=>l});function S(){const l=H({userConfig:i.config,defaultConfig:W});return l.theme?{...H({userConfig:Y.vue_ui_spark_trend[l.theme]||i.config,defaultConfig:l})}:l}const c=s(()=>T({data:i.dataset,threshold:e.value.downsample.threshold}));q(()=>i.config,l=>{e.value=S(),B()},{deep:!0}),q(()=>i.dataset,l=>{f.value=T({data:i.dataset,threshold:e.value.downsample.threshold}).map(t=>[void 0,1/0,-1/0,null,NaN].includes(t)?null:t)},{deep:!0});function z(l){return l.map(t=>h(t))}const f=k(T({data:i.dataset,threshold:e.value.downsample.threshold}).map(l=>e.value.style.animation.show||[void 0,1/0,-1/0,null,NaN].includes(l)?null:l)),m=k(!1),_=k(null);ee(()=>{B();let l=1e3/e.value.style.animation.animationFrames,t=performance.now();if(e.value.style.animation.show&&e.value.style.animation.animationFrames&&i.dataset.length>1){let v=function(){m.value=!0;let V=performance.now(),A=V-t;A>l?(t=V-A%l,g<c.value.length?(f.value.push(c.value[g]),g+=1,_.value=requestAnimationFrame(v)):(cancelAnimationFrame(_.value),f.value=z(c.value),m.value=!1)):_.value=requestAnimationFrame(v)};f.value=[];let g=0;v()}});function B(){K(i.dataset)&&Q({componentName:"VueUiSparkTrend",type:"dataset"})}const o=k({height:80,width:300}),p=s(()=>({top:e.value.style.padding.top,left:e.value.style.padding.left,right:o.value.width-e.value.style.padding.right,bottom:o.value.height-e.value.style.padding.bottom,height:o.value.height-(e.value.style.padding.top+e.value.style.padding.bottom)-(e.value.style.dataLabel.show?e.value.style.dataLabel.fontSize:0),width:o.value.width-(e.value.style.padding.left+e.value.style.padding.right)})),N=s(()=>{const l=z(c.value);return{max:Math.max(...l.map(t=>h(t))),min:Math.min(...l.map(t=>h(t)))}}),x=s(()=>{const l=N.value.min>=0?0:N.value.min;return Math.abs(l)}),R=s(()=>N.value.max+x.value);function F(l){return l/R.value}const U=s(()=>c.value.length),a=s(()=>f.value.map((l,t)=>{const v=isNaN(l)||[void 0,null,"NaN",NaN,1/0,-1/0].includes(l)?0:l||0;return{value:h(l),absoluteValue:h(v),plotValue:h(v+x.value),toMax:F(v+x.value),x:p.value.left+h(t*(p.value.width/(U.value-1)))-e.value.style.padding.right,y:p.value.bottom-h(p.value.height*F(v+x.value))}})),L=s(()=>{const l=z(c.value);return e.value.style.trendLabel.trendType==="global"?le(l):e.value.style.trendLabel.trendType==="n-1"&&l.length>1?(l.at(-1)/l.at(-2)-1)*100:e.value.style.trendLabel.trendType==="lastToFirst"?(l.at(-1)/l[0]-1)*100:0}),C=s(()=>m.value||L.value===0?"neutral":L.value>0?"positive":"negative"),r=s(()=>e.value.style.arrow.colors[C.value]),Z=s(()=>{const l={x:a.value[0].x,y:o.value.height-6},t={x:a.value[a.value.length-1].x,y:o.value.height-6},v=[];return a.value.forEach(g=>{v.push(`${g.x},${g.y} `)}),[l.x,l.y,...v,t.x,t.y].toString()}),I=s(()=>{let l=[];return a.value.forEach(t=>{l.push(`${t.x},${t.y} `)}),`M ${l.toString()}`});return(l,t)=>(u(),n("div",{class:"vue-ui-spark-trend",id:w.value,style:se(`width:100%;font-family:${e.value.style.fontFamily};background:${e.value.style.backgroundColor}`)},[J.value?(u(),n("svg",{key:1,xmlns:y(ae),viewBox:`0 0 ${o.value.width} ${o.value.height}`,style:"width:100%;background:transparent;overflow:visible"},[te(re),b("defs",null,[b("linearGradient",{x1:"0%",y1:"0%",x2:"0%",y2:"100%",id:`pill_gradient_${w.value}`},[b("stop",{offset:"0%","stop-color":y(j)(e.value.style.line.useColorTrend?r.value:e.value.style.line.stroke,e.value.style.area.opacity)},null,8,he),b("stop",{offset:"100%","stop-color":e.value.style.backgroundColor},null,8,pe)],8,ye)]),e.value.style.area.show&&a.value[0]?(u(),n("g",ce,[e.value.style.line.smooth?(u(),n("path",{key:0,d:`M ${a.value[0].x},${p.value.bottom} ${y(D)(a.value)} L ${a.value.at(-1).x},${p.value.bottom} Z`,fill:e.value.style.area.useGradient?`url(#pill_gradient_${w.value})`:y(j)(e.value.style.line.useColorTrend?r.value:e.value.style.line.stroke,e.value.style.area.opacity),stroke:"none"},null,8,ge)):(u(),n("path",{key:1,d:`M${Z.value}Z`,fill:e.value.style.area.useGradient?`url(#pill_gradient_${w.value})`:y(j)(e.value.style.line.useColorTrend?r.value:e.value.style.line.stroke,e.value.style.area.opacity),stroke:"none"},null,8,fe))])):d("",!0),e.value.style.line.smooth&&a.value.length?(u(),n("path",{key:1,d:`M ${y(D)(a.value)}`,stroke:e.value.style.line.useColorTrend?r.value:e.value.style.line.stroke,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":e.value.style.line.strokeLinecap,"stroke-linejoin":e.value.style.line.strokeLinejoin},null,8,me)):d("",!0),!e.value.style.line.smooth&&a.value.length?(u(),n("path",{key:2,d:I.value,stroke:e.value.style.line.useColorTrend?r.value:e.value.style.line.stroke,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":e.value.style.line.strokeLinecap,"stroke-linejoin":e.value.style.line.strokeLinejoin},null,8,ke)):d("",!0),m.value?d("",!0):(u(),n("foreignObject",{key:3,height:o.value.height/2,width:o.value.height/2,x:o.value.height/5,y:8},[b("div",we,[C.value==="positive"?(u(),$(M,{key:0,stroke:r.value,name:"arrowTop",size:o.value.height/2},null,8,["stroke","size"])):d("",!0),C.value==="negative"?(u(),$(M,{key:1,stroke:r.value,name:"arrowBottom",size:o.value.height/2},null,8,["stroke","size"])):d("",!0),C.value==="neutral"?(u(),$(M,{key:2,stroke:r.value,name:"arrowRight",size:o.value.height/2},null,8,["stroke","size"])):d("",!0)])],8,be)),m.value?d("",!0):(u(),n("text",{key:4,x:o.value.height/2-o.value.height/20,y:p.value.bottom,"text-anchor":"middle",fill:e.value.style.trendLabel.useColorTrend?r.value:e.value.style.trendLabel.color,"font-size":e.value.style.trendLabel.fontSize,"font-weight":e.value.style.trendLabel.bold?"bold":"normal"},E(y(G)({p:L.value>0?"+":"",v:L.value,s:"%",r:e.value.style.trendLabel.rounding})),9,xe)),a.value.length&&a.value.at(-1).x!==void 0?(u(),n("circle",{key:5,stroke:e.value.style.backgroundColor,"stroke-width":2,cx:a.value.at(-1).x,cy:a.value.at(-1).y,r:4,fill:r.value},null,8,Le)):d("",!0),a.value.length&&a.value.at(-1).x!==void 0&&e.value.style.dataLabel.show?(u(),n("text",{key:6,"text-anchor":"middle",x:a.value.at(-1).x,y:a.value.at(-1).y-e.value.style.dataLabel.fontSize/1.5,"font-size":e.value.style.dataLabel.fontSize,fill:e.value.style.dataLabel.useColorTrend?r.value:e.value.style.dataLabel.color,"font-weight":e.value.style.dataLabel.bold?"bold":"normal"},E(y(oe)(e.value.style.dataLabel.formatter,a.value.at(-1).value,y(G)({p:e.value.style.dataLabel.prefix,v:a.value.at(-1).value,s:e.value.style.dataLabel.suffix,r:e.value.style.dataLabel.rounding}),{datapoint:a.value.at(-1)})),9,Ce)):d("",!0)],8,de)):(u(),$(ie,{key:0,config:{type:"sparkline",style:{backgroundColor:e.value.style.backgroundColor,sparkline:{color:"#CCCCCC"}}}},null,8,["config"])),l.$slots.source?(u(),n("div",$e,[ue(l.$slots,"source",{},void 0,!0)],512)):d("",!0)],12,ve))}},Se=ne(ze,[["__scopeId","data-v-30936343"]]);export{Se as default};
