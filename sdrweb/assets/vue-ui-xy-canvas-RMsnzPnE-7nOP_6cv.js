import{z as xa,r as c,D as La,c as p,R as ka,A as F,H as Ca,ao as Ge,w as N,B as $a,C as wa,Q as Ve,E as za,aD as Sa,ak as Ma,aO as Ta,ad as be,O as q,U as K,G as Q,I as Ia,b as Oa,ac as Ra,V as _a,N as Ea,o as $,a as J,M as ee,i as R,L as A,j as Pa,l as f,m,p as B,q as X,u as H,e as ae,a2 as je,a3 as Fa,f as Na,h as qe,g as Aa,n as Ha}from"./index-UNQvOp-_.js";import{O as Wa,k as Da,E as Ua,C as b,L as xe,I as _,m as Ke,b as Qe,S as Ya}from"./useResponsive-CoxXLe23-CoJWR8uA.js";import{E as Ba}from"./Tooltip-qod9o4Vz-yuZ96RAr.js";import{C as Xa}from"./Legend-BorSDXCj-BlB-FUJn.js";import{x as Za}from"./Title-DyD-mBPN-D1JKsC4v.js";import{U as Ga}from"./Slicer-BLQZ4Fne-CFW9kebM.js";import{r as Va,a as ja}from"./usePrinter-CLcxWv-4-BCaxEi1-.js";import qa from"./vue-ui-accordion-m8rut1bP-B24xq09o.js";import{W as Ka}from"./DataTable-D8fcY_sJ-DwUEw2sq.js";import Qa from"./vue-ui-skeleton-Dgzcn3FL-BesRK3Fh.js";import{c as Je}from"./useNestedProp-BxrcwmTZ-CudEJDco.js";import{S as Ja}from"./PenAndPaper-Dk41ZrJ0-C6X1XG5F.js";import{s as el}from"./vue-data-ui-DF7u-eZV-Cm3hFNaA.js";import"./Shape-DYFnvMNd-Cz606loY.js";import"./PackageVersion-mSsg8dpu-BpMA5JNq.js";const al=["id"],ll=["onClick"],tl={key:2,class:"vue-data-ui-watermark"},ol=["innerHTML"],sl={__name:"vue-ui-xy-canvas",props:{dataset:{type:Array,default(){return[]}},config:{type:Object,default(){return{}}}},emits:["selectLegend"],setup(Le,{expose:ea,emit:aa}){const x=Le,{vue_ui_xy_canvas:la}=xa(),ne=c(La()),Z=c(null),z=c(null),G=c(null),i=c(null),y=c(1),I=c(1),le=c(!1),d=c(null),te=c(""),ke=c(null),w=c([]),W=c(1),E=c(!0),S=c(!0),ve=c(null),Ce=c(0),$e=c(0),ce=c(!1),we=c(null),ze=c(null),Se=c(null),Me=c(null),de=c(0),he=c(0),ye=c(0),ge=p(()=>!!x.dataset&&x.dataset.length),a=p({get:()=>Te(),set:e=>e});function Te(){const e=Je({userConfig:x.config,defaultConfig:la});let t={};return e.theme?t={...Je({userConfig:Ca.vue_ui_xy_canvas[e.theme]||x.config,defaultConfig:e}),customPalette:ka[e.theme]||F}:t=e,x.config&&Ge(x.config,"style.chart.scale.min")?t.style.chart.scale.min=x.config.style.chart.scale.min:t.style.chart.scale.min=null,x.config&&Ge(x.config,"style.chart.scale.max")?t.style.chart.scale.max=x.config.style.chart.scale.max:t.style.chart.scale.max=null,t}N(()=>x.config,e=>{a.value=Te(),pe(),de.value+=1,he.value+=1,ye.value+=1},{deep:!0}),N(()=>x.dataset,()=>{pe(),de.value+=1,he.value+=1,ye.value+=1},{deep:!0});const Ie=c(a.value.style.chart.aspectRatio),{isPrinting:Oe,isImaging:Re,generatePdf:_e,generateImage:Ee}=Va({elementId:`xy_canvas_${ne.value}`,fileName:a.value.style.chart.title.text||"vue-ui-xy-canvas"}),u=c({showTable:a.value.table.show,showDataLabels:a.value.style.chart.dataLabels.show,stacked:a.value.style.chart.stacked,showTooltip:a.value.style.chart.tooltip.show});function ta(e){ce.value=e,$e.value+=1}const Pe=p(()=>za(a.value.customPalette)),O=p(()=>D.value?Math.max(...D.value.filter((e,t)=>!w.value.includes(e.absoluteIndex)).map(e=>e.series.length)):0),l=p(()=>{const e=y.value-y.value*(a.value.style.chart.paddingProportions.left+a.value.style.chart.paddingProportions.right);return{canvasWidth:y.value,canvasHeight:I.value,left:y.value*a.value.style.chart.paddingProportions.left,top:I.value*a.value.style.chart.paddingProportions.top,right:y.value-y.value*a.value.style.chart.paddingProportions.right,bottom:I.value-I.value*a.value.style.chart.paddingProportions.bottom,width:e,height:I.value-I.value*(a.value.style.chart.paddingProportions.top+a.value.style.chart.paddingProportions.bottom),slot:e/(s.value.end-s.value.start)}});function Fe(e,t){return e/t}function oa({hasAutoScale:e,series:t,min:o,max:v,scale:n,yOffset:k,individualHeight:r,stackIndex:C=null}){return t.map((M,P)=>{const U=n.min<0?Math.abs(n.min):0,Y=Fe(M+U,U+n.max);let V,j;e&&(V=Math.abs(n.min),j=Fe(M+V,n.max+V));let T=0;return C===null?T=l.value.bottom-l.value.height*(e?j:Y):T=l.value.bottom-k-r*(e?j:Y),{x:l.value.left+l.value.slot*P+l.value.slot/2,y:T,value:M}})}const g=p(()=>{const e=a.value.style.chart.scale.min!==null?a.value.style.chart.scale.min:Math.min(...D.value.filter((r,C)=>!w.value.includes(r.absoluteIndex)).flatMap(r=>r.series.slice(s.value.start,s.value.end))),t=a.value.style.chart.scale.max!==null?a.value.style.chart.scale.max:Math.max(...D.value.filter((r,C)=>!w.value.includes(r.absoluteIndex)).flatMap(r=>r.series.slice(s.value.start,s.value.end))),o=be(e<0?e:0,t===e?e+1<0?0:e+1:t<0?0:t,a.value.style.chart.scale.ticks),v=o.min<0?Math.abs(o.min):0,n=l.value.bottom-l.value.height*(v/(o.max+v)),k=o.ticks.map(r=>({y:l.value.bottom-l.value.height*((r+v)/(o.max+v)),x:l.value.left-8,value:r}));return{absoluteMin:v,max:t,min:e,scale:o,yLabels:k,zero:n}}),sa=p(()=>h.value.map(e=>`
            <div style="display:flex;flex-direction:row;gap:6px;align-items:center;">
                <svg viewBox="0 0 10 10" height="12" width="12">
                    <circle cx="5" cy="5" r="5" fill="${e.color}"/>
                </svg>
                <span>${e.name?e.name+": ":""}</span>
                <span>${K(a.value.style.chart.dataLabels.formatter,e.series[d.value],Q({p:e.prefix||"",v:e.series[d.value],s:e.suffix||"",r:e.rounding||0}),{datapoint:e,seriesIndex:d.value})}</span>
            </div>
        `)),D=p(()=>x.dataset.map((e,t)=>({...e,series:Sa({data:Ma(e.series),threshold:a.value.downsample.threshold}),absoluteIndex:t,color:Ve(e.color||Pe.value[t]||F[t]||F[t%F.length])})));N(O,e=>{e&&Ne()});const h=p(()=>Ta(D.value.filter((e,t)=>!w.value.includes(e.absoluteIndex))).map((e,t)=>({...e,series:e.series.slice(s.value.start,s.value.end)})).map((e,t)=>{let o=[null,void 0].includes(e.scaleMin)?Math.min(...e.series)||0:e.scaleMin,v=[null,void 0].includes(e.scaleMax)?Math.max(...e.series)||1:e.scaleMax;o===v&&(o=o>=0?v-1:o,v=v>=0?v:o+1);const n={ratios:e.series.filter(T=>![null,void 0].includes(T)).map(T=>(T-o)/(v-o)),valueMin:o,valueMax:v},k=e.scaleSteps||a.value.style.chart.scale.ticks;let r;e.autoScaling?r=be(n.valueMin,n.valueMax,k):r=be(n.valueMin<0?n.valueMin:0,n.valueMax<=0?0:n.valueMax,k);const C=u.value.stacked?l.value.height*(1-e.cumulatedStackRatio):0,M=u.value.stacked?l.value.height/a.value.style.chart.stackGap:0,P=u.value.stacked?l.value.height*e.stackRatio-M:l.value.height,U=r.min<0?Math.abs(r.min):0;let Y;e.autoScaling&&u.value.stacked&&v<=0?Y=l.value.bottom-C-P:Y=l.value.bottom-C-P*(U/(r.max+U));const V=r.ticks.map((T,ba)=>({y:l.value.bottom-C-P*(ba/(r.ticks.length-1)),x:l.value.left-8,value:T})),j=oa({hasAutoScale:u.value.stacked&&e.autoScaling,series:e.series,min:u.value.stacked?o:g.value.min,max:u.value.stacked?v:g.value.max,scale:u.value.stacked?r:g.value.scale,yOffset:C,individualHeight:P,stackIndex:u.value.stacked?t:null});return{...e,coordinatesLine:j,min:o,max:v,localScale:r,localZero:Y,localMin:U,localYLabels:V,yOffset:C,individualHeight:P}})),s=c({start:0,end:O.value});function Ne(){s.value={start:0,end:O.value},Ce.value+=1}const ua=p(()=>h.value.filter(e=>["line","plot",void 0].includes(e.type))),L=p(()=>h.value.filter(e=>e.type==="bar"));function ra(){if(!z.value)return;const e=G.value.offsetWidth,t=G.value.offsetHeight;z.value.width=e*W.value*2,z.value.height=t*W.value*2,y.value=e*W.value*2,I.value=t*W.value*2,i.value.scale(W.value,W.value),fe()}function ia(){if(i.value.clearRect(0,0,1e4,1e4),i.value.fillStyle=a.value.style.chart.backgroundColor,i.value.fillRect(0,0,l.value.canvasWidth,l.value.canvasHeight),u.value.stacked)a.value.style.chart.grid.y.verticalLines.show&&s.value.end-s.value.start<a.value.style.chart.grid.y.verticalLines.hideUnderXLength?h.value.forEach(e=>{for(let t=0;t<s.value.end-s.value.start+1;t+=1)b(i.value,[{x:l.value.left+l.value.slot*t,y:l.value.bottom-e.yOffset-e.individualHeight},{x:l.value.left+l.value.slot*t,y:l.value.bottom-e.yOffset}],{color:a.value.style.chart.grid.y.verticalLines.color})}):a.value.style.chart.grid.y.verticalLines.show&&s.value.end-s.value.start>=a.value.style.chart.grid.y.verticalLines.hideUnderXLength&&h.value.forEach(e=>{for(let t=s.value.start;t<s.value.end;t+=1)t%Math.floor((s.value.end-s.value.start)/a.value.style.chart.grid.y.timeLabels.modulo)===0&&b(i.value,[{x:l.value.left+l.value.slot*(t-s.value.start)+l.value.slot/2,y:l.value.bottom-e.yOffset-e.individualHeight},{x:l.value.left+l.value.slot*(t-s.value.start)+l.value.slot/2,y:l.value.bottom-e.yOffset}],{color:a.value.style.chart.grid.y.verticalLines.color})}),a.value.style.chart.grid.x.horizontalLines.show&&(a.value.style.chart.grid.x.horizontalLines.alternate?h.value.forEach(e=>{e.localYLabels.forEach((t,o)=>{o<e.localYLabels.length-1&&xe(i.value,[{x:l.value.left,y:t.y},{x:l.value.right,y:t.y},{x:l.value.right,y:e.localYLabels[o+1].y},{x:l.value.left,y:e.localYLabels[o+1].y}],{fillColor:o%2===0?"transparent":q(a.value.style.chart.grid.x.horizontalLines.color,a.value.style.chart.grid.x.horizontalLines.opacity),strokeColor:"transparent"})})}):h.value.forEach(e=>{e.localYLabels.slice(s.value.start,s.value.end).forEach(t=>{b(i.value,[{x:l.value.left,y:t.y},{x:l.value.right,y:t.y}],{color:a.value.style.chart.grid.x.horizontalLines.color})})})),a.value.style.chart.grid.zeroLine.show&&h.value.forEach(e=>{b(i.value,[{x:l.value.left,y:e.localZero},{x:l.value.right,y:e.localZero}],{color:a.value.style.chart.grid.zeroLine.color,lineDash:a.value.style.chart.grid.zeroLine.dashed?[10,10]:[0,0]})}),a.value.style.chart.grid.y.axisLabels.show&&h.value.forEach(e=>{b(i.value,[{x:l.value.left,y:l.value.bottom-e.yOffset},{x:l.value.left,y:l.value.bottom-e.yOffset-e.individualHeight}],{color:e.color}),b(i.value,[{x:l.value.right,y:l.value.bottom-e.yOffset},{x:l.value.right,y:l.value.bottom-e.yOffset-e.individualHeight}],{color:e.color}),e.localYLabels.forEach((t,o)=>{_(i.value,K(a.value.style.chart.dataLabels.formatter,t.value,Q({p:e.prefix||a.value.style.chart.grid.y.axisLabels.prefix||"",v:t.value,s:e.suffix||a.value.style.chart.grid.y.axisLabels.suffix||"",r:e.rounding||a.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:t,seriesIndex:o}),t.x+a.value.style.chart.grid.y.axisLabels.offsetX,t.y,{align:"right",font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:e.color})})}),h.value.forEach(e=>{_(i.value,e.name,y.value/35,l.value.bottom-e.yOffset-e.individualHeight/2,{align:"center",rotation:-90,color:e.color,font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`})});else{if(a.value.style.chart.grid.y.verticalLines.show&&s.value.end-s.value.start<a.value.style.chart.grid.y.verticalLines.hideUnderXLength)for(let e=0;e<s.value.end-s.value.start+1;e+=1)b(i.value,[{x:l.value.left+l.value.slot*e,y:l.value.top},{x:l.value.left+l.value.slot*e,y:l.value.bottom}],{color:a.value.style.chart.grid.y.verticalLines.color});else if(a.value.style.chart.grid.y.verticalLines.show&&s.value.end-s.value.start>=a.value.style.chart.grid.y.verticalLines.hideUnderXLength)for(let e=s.value.start;e<s.value.end;e+=1)e%Math.floor((s.value.end-s.value.start)/a.value.style.chart.grid.y.timeLabels.modulo)===0&&b(i.value,[{x:l.value.left+l.value.slot*(e-s.value.start)+l.value.slot/2,y:l.value.top},{x:l.value.left+l.value.slot*(e-s.value.start)+l.value.slot/2,y:l.value.bottom}],{color:a.value.style.chart.grid.y.verticalLines.color});a.value.style.chart.grid.x.horizontalLines.show&&(a.value.style.chart.grid.x.horizontalLines.alternate?g.value.yLabels.forEach((e,t)=>{t<g.value.yLabels.length-1&&xe(i.value,[{x:l.value.left,y:e.y},{x:l.value.right,y:e.y},{x:l.value.right,y:g.value.yLabels[t+1].y},{x:l.value.left,y:g.value.yLabels[t+1].y}],{fillColor:t%2===0?"transparent":q(a.value.style.chart.grid.x.horizontalLines.color,a.value.style.chart.grid.x.horizontalLines.opacity),strokeColor:"transparent"})}):g.value.yLabels.forEach(e=>{b(i.value,[{x:l.value.left,y:e.y},{x:l.value.right,y:e.y}],{color:a.value.style.chart.grid.x.horizontalLines.color})})),a.value.style.chart.grid.y.showAxis&&b(i.value,[{x:l.value.left,y:l.value.top},{x:l.value.left,y:l.value.bottom}],{color:a.value.style.chart.grid.y.axisColor,lineWidth:a.value.style.chart.grid.y.axisThickness}),a.value.style.chart.grid.x.showAxis&&b(i.value,[{x:l.value.left,y:l.value.bottom},{x:l.value.right,y:l.value.bottom}],{color:a.value.style.chart.grid.x.axisColor,lineWidth:a.value.style.chart.grid.x.axisThickness}),a.value.style.chart.grid.zeroLine.show&&b(i.value,[{x:l.value.left,y:g.value.zero},{x:l.value.right,y:g.value.zero}],{color:a.value.style.chart.grid.zeroLine.color,lineDash:a.value.style.chart.grid.zeroLine.dashed?[10,10]:[0,0]}),a.value.style.chart.grid.y.axisLabels.show&&g.value.yLabels.forEach((e,t)=>{_(i.value,K(a.value.style.chart.dataLabels.formatter,e.value,Q({p:a.value.style.chart.grid.y.axisLabels.prefix||"",v:e.value,s:a.value.style.chart.grid.y.axisLabels.suffix||"",r:a.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:e,seriesIndex:t}),e.x+a.value.style.chart.grid.y.axisLabels.offsetX,e.y,{align:"right",font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.grid.y.axisLabels.color})})}a.value.style.chart.grid.y.axisName&&_(i.value,a.value.style.chart.grid.y.axisName,y.value-y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio*1.2,l.value.bottom-l.value.height/2,{font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.color,align:"center",rotation:90}),a.value.style.chart.grid.x.axisName&&_(i.value,a.value.style.chart.grid.x.axisName,y.value/2,I.value,{font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.color,align:"center"})}function na(e){for(let t=0;t<e.coordinatesLine.length;t+=1){const o=(d.value===t?y.value/150:a.value.style.chart.line.plots.show?y.value/200:0)*a.value.style.chart.line.plots.radiusRatio;Qe(i.value,{x:e.coordinatesLine[t].x,y:e.coordinatesLine[t].y},o,{color:a.value.style.chart.backgroundColor,fillStyle:e.color,strokeColor:"transparent"})}}function va(e){for(let t=0;t<e.coordinatesLine.length;t+=1)_(i.value,K(a.value.style.chart.dataLabels.formatter,e.coordinatesLine[t].value,Q({p:e.prefix||"",v:e.coordinatesLine[t].value,s:e.suffix||"",r:e.rounding||0}),{datapoint:e.coordinatesLine[t],seriesIndex:t}),e.coordinatesLine[t].x,e.coordinatesLine[t].y+a.value.style.chart.dataLabels.offsetY,{align:"center",font:`${Math.round(y.value/40*a.value.style.chart.dataLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.dataLabels.useSerieColor?e.color:a.value.style.chart.dataLabels.color,strokeColor:a.value.style.chart.backgroundColor,lineWidth:.8})}function ca(){for(let e=s.value.start;e<s.value.end;e+=1)(s.value.end-s.value.start<a.value.style.chart.grid.y.timeLabels.modulo||s.value.end-s.value.start>=a.value.style.chart.grid.y.timeLabels.modulo&&(e%Math.floor((s.value.end-s.value.start)/a.value.style.chart.grid.y.timeLabels.modulo)===0||e===d.value+s.value.start))&&_(i.value,a.value.style.chart.grid.y.timeLabels.values[e]||e+1,l.value.left+l.value.slot*(e-s.value.start)+l.value.slot/2,l.value.bottom+y.value/a.value.style.chart.grid.y.timeLabels.offsetY,{align:a.value.style.chart.grid.y.timeLabels.rotation===0?"center":a.value.style.chart.grid.y.timeLabels.rotation>0?"left":"right",font:`${Math.round(y.value/40*a.value.style.chart.grid.y.timeLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:q(a.value.style.chart.grid.y.timeLabels.color,d.value!==null?d.value+s.value.start===e?100:20:100),rotation:a.value.style.chart.grid.y.timeLabels.rotation})}function Ae(){b(i.value,[{x:l.value.left+l.value.slot*d.value+l.value.slot/2,y:l.value.top},{x:l.value.left+l.value.slot*d.value+l.value.slot/2,y:l.value.bottom}],{color:a.value.style.chart.selector.color,lineDash:a.value.style.chart.selector.dashed?[8,8]:[0,0],lineWidth:2,linceCap:"round"})}function da(){L.value.forEach((e,t)=>{for(let o=0;o<e.coordinatesLine.length;o+=1)xe(i.value,[{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/L.value.length*t-(t===0?0:l.value.slot/(5*L.value.length)*t)),y:u.value.stacked?e.localZero:g.value.zero},{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/L.value.length*t-(t===0?0:l.value.slot/(5*L.value.length)*t))+l.value.slot*.8/(u.value.stacked?1:L.value.length),y:u.value.stacked?e.localZero:g.value.zero},{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/L.value.length*t-(t===0?0:l.value.slot/(5*L.value.length)*t))+l.value.slot*.8/(u.value.stacked?1:L.value.length),y:e.coordinatesLine[o].y},{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/L.value.length*t-(t===0?0:l.value.slot/(5*L.value.length)*t)),y:e.coordinatesLine[o].y}],{strokeColor:a.value.style.chart.backgroundColor,gradient:{type:"linear",start:{x:e.coordinatesLine[o].x,y:e.coordinatesLine[o].y},end:{x:e.coordinatesLine[o].x,y:u.value.stacked?e.localZero:g.value.zero},stops:[{offset:0,color:e.color},{offset:1,color:Ia(e.color,.5)}]}}),u.value.showDataLabels&&[!0,void 0].includes(e.dataLabels)&&_(i.value,K(a.value.style.chart.dataLabels.formatter,e.coordinatesLine[o].value,Q({p:e.prefix||"",v:e.coordinatesLine[o].value,s:e.suffix||"",r:e.rounding||0}),{datapoint:e.coordinatesLine[o],seriesIndex:o}),l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/L.value.length*t-(t===0?0:l.value.slot/(5*L.value.length)*t))+l.value.slot*.4/(u.value.stacked?1:L.value.length),(e.coordinatesLine[o].value<0?u.value.stacked?e.localZero:g.value.zero:e.coordinatesLine[o].y)+a.value.style.chart.dataLabels.offsetY,{align:"center",font:`${Math.round(y.value/40*a.value.style.chart.dataLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.dataLabels.useSerieColor?e.color:a.value.style.chart.dataLabels.color,strokeColor:a.value.style.chart.backgroundColor,lineWidth:.8})})}function ha(e){e.useArea?u.value.stacked?Ke(i.value,[{x:e.coordinatesLine[0].x,y:e.localZero},...e.coordinatesLine,{x:e.coordinatesLine.at(-1).x,y:e.localZero}],{fillColor:q(e.color,a.value.style.chart.area.opacity),strokeColor:"transparent"}):Ke(i.value,[{x:e.coordinatesLine[0].x,y:g.value.zero},...e.coordinatesLine,{x:e.coordinatesLine.at(-1).x,y:g.value.zero}],{fillColor:q(e.color,a.value.style.chart.area.opacity),strokeColor:"transparent"}):b(i.value,e.coordinatesLine,{color:e.color,lineWidth:3})}function ya(){h.value.forEach((e,t)=>{b(i.value,[{x:l.value.left,y:l.value.bottom-e.yOffset},{x:l.value.right,y:l.value.bottom-e.yOffset}],{color:a.value.style.chart.grid.x.horizontalLines.color,lineWidth:1})})}function fe(){ia(),E.value?(S.value&&d.value!==null&&a.value.style.chart.selector.show&&Ae(),da(),u.value.stacked&&a.value.style.chart.grid.x.showAxis&&ya(),ua.value.forEach(e=>{(e.type==="line"||!e.type)&&ha(e),S.value&&(na(e),u.value.showDataLabels&&[!0,void 0].includes(e.dataLabels)&&va(e))}),ve.value=Ya(z.value)):(ve.value&&(i.value.clearRect(0,0,1e4,1e4),i.value.drawImage(ve.value,0,0)),S.value&&d.value!==null&&a.value.style.chart.selector.show&&Ae(),S.value&&d.value!==null&&h.value.forEach(e=>{if(e.type==="line"||!e.type||e.type==="plot"){if(!e.coordinatesLine[d.value])return;e.coordinatesLine[d.value].x!==void 0&&e.coordinatesLine[d.value].y!==void 0&&Qe(i.value,{x:e.coordinatesLine[d.value].x,y:e.coordinatesLine[d.value].y},y.value/150*a.value.style.chart.line.plots.radiusRatio,{color:a.value.style.chart.backgroundColor,fillStyle:e.color,strokeColor:"transparent"})}})),a.value.style.chart.grid.y.timeLabels.show&&ca(),E.value=!1}const oe=Ua(()=>{S.value=!0,ra()},O.value>200?10:1,!S.value);function ga(e){const{left:t}=z.value.getBoundingClientRect(),o=e.clientX-t;if(o*2<l.value.left||o*2>l.value.right){le.value=!1,d.value=null;return}const v=o*2-l.value.left;if(d.value=Math.floor(v/l.value.slot),le.value=!0,!S.value)return;let n="";const k=a.value.style.chart.tooltip.customFormat;je(k)&&Fa(()=>k({seriesIndex:d.value,datapoint:h.value.map(r=>({shape:r.shape||null,name:r.name,color:r.color,type:r.type||"line",value:r.series.find((C,M)=>M===d.value)})),series:h.value,config:a.value}))?te.value=k({seriesIndex:d.value,datapoint:h.value.map(r=>({shape:r.shape||null,name:r.name,color:r.color,type:r.type||"line",value:r.series.find((C,M)=>M===d.value)})),series:h.value,config:a.value}):(a.value.style.chart.grid.y.timeLabels.values.slice(s.value.start,s.value.end)[d.value]&&(n+=`<div style="padding-bottom: 6px; margin-bottom: 4px; border-bottom: 1px solid ${a.value.style.chart.tooltip.borderColor}; width:100%">${a.value.style.chart.grid.y.timeLabels.values.slice(s.value.start,s.value.end)[d.value]}</div>`),n+=sa.value.join(""),te.value=n),S.value=!1}N(()=>d.value,e=>{oe()}),N(()=>s.value,e=>{E.value=!0,fe()},{deep:!0}),N(()=>u.value.showDataLabels,e=>{E.value=!0,fe()}),N(()=>u.value.stacked,e=>{E.value=!0,S.value=!0,oe()});function fa(){le.value=!1,d.value=null,te.value=""}const se=c(null),ue=c(null);Oa(()=>{pe()});function pe(){if($a(x.dataset)?wa({componentName:"VueUiXyCanvas",type:"dataset"}):z.value&&(i.value=z.value.getContext("2d",{willReadFrequently:!0})),a.value.responsive){const e=Wa(()=>{const{width:t,height:o}=Da({chart:Z.value,title:a.value.style.chart.title.text?we.value:null,legend:a.value.style.chart.legend.show?ze.value:null,slicer:a.value.style.chart.zoom.show&&O.value>1?Se.value:null,source:Me.value});Ie.value=`${t} / ${o}`});se.value=new ResizeObserver(e),se.value.observe(Z.value.parentNode)}ue.value=new ResizeObserver(e=>{for(const t of e)t.contentBoxSize&&G.value&&(E.value=!0,oe())}),ue.value.observe(G.value)}Ra(()=>{ue.value&&ue.value.disconnect(),se.value&&se.value.disconnect()});function He(e){aa("selectLegend",h.value.find(t=>t.absoluteIndex===e)),w.value.includes(e)?w.value=w.value.filter(t=>t!==e):w.value.push(e),E.value=!0,oe()}const We=p(()=>D.value.map((e,t)=>({...e,name:e.name,color:Ve(e.color)||Pe.value[t]||F[t]||F[t%F.length],shape:e.shape||"circle",prefix:e.prefix||"",suffix:e.suffix||"",rounding:e.rounding||0})).map(e=>({...e,opacity:w.value.includes(e.absoluteIndex)?.5:1,segregate:()=>He(e.absoluteIndex),isSegregated:w.value.includes(e.absoluteIndex)}))),pa=p(()=>({cy:"donut-div-legend",backgroundColor:a.value.style.chart.legend.backgroundColor,color:a.value.style.chart.legend.color,fontSize:a.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:a.value.style.chart.legend.bold?"bold":""})),re=p(()=>{const e=[""].concat(h.value.map(n=>n.name)).concat(' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>');let t=[];for(let n=0;n<O.value;n+=1){const k=h.value.map(r=>r.series[n]??0).reduce((r,C)=>r+C,0);t.push([a.value.style.chart.grid.y.timeLabels.values.slice(s.value.start,s.value.end)[n]??n+1].concat(h.value.map(r=>(r.series[n]??0).toFixed(a.value.table.rounding))).concat((k??0).toFixed(a.value.table.rounding)))}const o={th:{backgroundColor:a.value.table.th.backgroundColor,color:a.value.table.th.color,outline:a.value.table.th.outline},td:{backgroundColor:a.value.table.td.backgroundColor,color:a.value.table.td.color,outline:a.value.table.td.outline},breakpoint:a.value.table.responsiveBreakpoint},v=[a.value.table.columnNames.period].concat(h.value.map(n=>n.name)).concat(a.value.table.columnNames.total);return{head:e,body:t.slice(0,s.value.end-s.value.start),config:o,colNames:v}}),De=p(()=>{if(h.value.length===0)return{head:[],body:[],config:{},columnNames:[]};const e=h.value.map(o=>({label:o.name,color:o.color,type:o.type})),t=[];for(let o=s.value.start;o<s.value.end;o+=1){const v=[a.value.style.chart.grid.y.timeLabels.values[o]||o+1];h.value.forEach(n=>{v.push(Number((n.series[o]||0).toFixed(a.value.table.rounding)))}),t.push(v)}return{head:e,body:t}});function Ue(){const e=[[a.value.style.chart.title.text],[a.value.style.chart.title.subtitle.text],[""]],t=["",...De.value.head.map(k=>k.label)],o=De.value.body,v=e.concat([t]).concat(o),n=_a(v);Ea({csvContent:n,title:a.value.style.chart.title.text||"vue-ui-xy-canvas"})}function ma(){return h.value}function Ye(){u.value.showTable=!u.value.showTable}function Be(){u.value.showDataLabels=!u.value.showDataLabels}function Xe(){u.value.stacked=!u.value.stacked}function Ze(){u.value.showTooltip=!u.value.showTooltip}const ie=c(!1);function me(){ie.value=!ie.value}return ea({getData:ma,generateCsv:Ue,generatePdf:_e,generateImage:Ee,toggleTable:Ye,toggleLabels:Be,toggleStack:Xe,toggleTooltip:Ze,toggleAnnotator:me}),(e,t)=>($(),J("div",{style:ee(`width:100%; position:relative; ${a.value.responsive?"height: 100%":""}`),ref_key:"xy",ref:Z,id:`xy_canvas_${ne.value}`,class:Ha(`vue-ui-donut ${ce.value?"vue-data-ui-wrapper-fullscreen":""}`)},[a.value.style.chart.title.text?($(),J("div",{key:0,ref_key:"chartTitle",ref:we,style:ee(`width:100%;background:${a.value.style.chart.backgroundColor};`)},[($(),R(Za,{key:`title_${de.value}`,config:{title:{cy:"xy-canvas-title",...a.value.style.chart.title},subtitle:{cy:"xy-canvas-subtitle",...a.value.style.chart.title.subtitle}}},null,8,["config"]))],4)):A("",!0),a.value.userOptions.show&&ge.value?($(),R(ja,{ref:"details",key:`user_option_${$e.value}`,backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color,isPrinting:H(Oe),isImaging:H(Re),uid:ne.value,hasTooltip:a.value.userOptions.buttons.tooltip&&a.value.style.chart.tooltip.show,hasPdf:a.value.userOptions.buttons.pdf,hasImg:a.value.userOptions.buttons.img,hasXls:a.value.userOptions.buttons.csv,hasLabel:a.value.userOptions.buttons.labels,hasStack:Le.dataset.length>1&&a.value.userOptions.buttons.stack,hasFullscreen:a.value.userOptions.buttons.fullscreen,hasTable:s.value.end-s.value.start<200&&a.value.userOptions.buttons.table,isFullscreen:ce.value,isTooltip:u.value.showTooltip,isStacked:u.value.stacked,titles:{...a.value.userOptions.buttonTitles},chartElement:Z.value,position:a.value.userOptions.position,hasAnnotator:a.value.userOptions.buttons.annotator,isAnnotation:ie.value,onToggleFullscreen:ta,onGeneratePdf:H(_e),onGenerateCsv:Ue,onGenerateImage:H(Ee),onToggleTable:Ye,onToggleLabels:Be,onToggleStack:Xe,onToggleTooltip:Ze,onToggleAnnotator:me},Pa({_:2},[e.$slots.optionTooltip?{name:"optionTooltip",fn:f(()=>[m(e.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,e.$slots.optionPdf?{name:"optionPdf",fn:f(()=>[m(e.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,e.$slots.optionCsv?{name:"optionCsv",fn:f(()=>[m(e.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,e.$slots.optionImg?{name:"optionImg",fn:f(()=>[m(e.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,e.$slots.optionTable?{name:"optionTable",fn:f(()=>[m(e.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,e.$slots.optionLabels?{name:"optionLabels",fn:f(()=>[m(e.$slots,"optionLabels",{},void 0,!0)]),key:"5"}:void 0,e.$slots.optionStack?{name:"optionStack",fn:f(()=>[m(e.$slots,"optionStack",{},void 0,!0)]),key:"6"}:void 0,e.$slots.optionFullscreen?{name:"optionFullscreen",fn:f(({toggleFullscreen:o,isFullscreen:v})=>[m(e.$slots,"optionFullscreen",B(X({toggleFullscreen:o,isFullscreen:v})),void 0,!0)]),key:"7"}:void 0,e.$slots.optionAnnotator?{name:"optionAnnotator",fn:f(({toggleAnnotator:o,isAnnotator:v})=>[m(e.$slots,"optionAnnotator",B(X({toggleAnnotator:o,isAnnotator:v})),void 0,!0)]),key:"8"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasImg","hasXls","hasLabel","hasStack","hasFullscreen","hasTable","isFullscreen","isTooltip","isStacked","titles","chartElement","position","hasAnnotator","isAnnotation","onGeneratePdf","onGenerateImage"])):A("",!0),ae("div",{class:"vue-ui-xy-canvas",style:ee(`position: relative; aspect-ratio: ${Ie.value}`),ref_key:"container",ref:G},[ge.value?($(),J("canvas",{key:0,ref_key:"canvas",ref:z,style:{width:"100%",height:"100%"},onMousemove:t[0]||(t[0]=o=>ga(o)),onMouseleave:fa},null,544)):($(),R(Qa,{key:1,config:{type:"line",style:{backgroundColor:a.value.style.chart.backgroundColor,line:{axis:{color:"#CCCCCC"},path:{color:"#CCCCCC",strokeWidth:.5}}}}},null,8,["config"])),Na(Ba,{show:u.value.showTooltip&&le.value,backgroundColor:a.value.style.chart.tooltip.backgroundColor,color:a.value.style.chart.tooltip.color,fontSize:a.value.style.chart.tooltip.fontSize,borderRadius:a.value.style.chart.tooltip.borderRadius,borderColor:a.value.style.chart.tooltip.borderColor,borderWidth:a.value.style.chart.tooltip.borderWidth,position:a.value.style.chart.tooltip.position,offsetY:a.value.style.chart.tooltip.offsetY,parent:z.value,content:te.value,backgroundOpacity:a.value.style.chart.tooltip.backgroundOpacity,isCustom:H(je)(a.value.style.chart.tooltip.customFormat)},{"tooltip-before":f(()=>[m(e.$slots,"tooltip-before",B(X({...ke.value})),void 0,!0)]),"tooltip-after":f(()=>[m(e.$slots,"tooltip-after",B(X({...ke.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","fontSize","borderRadius","borderColor","borderWidth","position","offsetY","parent","content","backgroundOpacity","isCustom"])],4),ae("div",{ref_key:"chartSlicer",ref:Se,style:ee(`width:100%;background:${a.value.style.chart.backgroundColor}`),"data-html2canvas-ignore":""},[a.value.style.chart.zoom.show&&O.value>1?($(),R(Ga,{key:`slicer_${Ce.value}`,background:a.value.style.chart.zoom.color,borderColor:a.value.style.chart.backgroundColor,fontSize:a.value.style.chart.zoom.fontSize,useResetSlot:a.value.style.chart.zoom.useResetSlot,labelLeft:a.value.style.chart.grid.y.timeLabels.values[s.value.start]?a.value.style.chart.grid.y.timeLabels.values[s.value.start]:"",labelRight:a.value.style.chart.grid.y.timeLabels.values[s.value.end-1]?a.value.style.chart.grid.y.timeLabels.values[s.value.end-1]:"",textColor:a.value.style.chart.color,inputColor:a.value.style.chart.zoom.color,selectColor:a.value.style.chart.zoom.highlightColor,max:O.value,min:0,valueStart:s.value.start,valueEnd:s.value.end,start:s.value.start,"onUpdate:start":t[1]||(t[1]=o=>s.value.start=o),end:s.value.end,"onUpdate:end":t[2]||(t[2]=o=>s.value.end=o),onReset:Ne},{"reset-action":f(({reset:o})=>[m(e.$slots,"reset-action",B(X({reset:o})),void 0,!0)]),_:3},8,["background","borderColor","fontSize","useResetSlot","labelLeft","labelRight","textColor","inputColor","selectColor","max","valueStart","valueEnd","start","end"])):A("",!0)],4),ae("div",{ref_key:"chartLegend",ref:ze},[a.value.style.chart.legend.show&&ge.value?($(),R(Xa,{legendSet:We.value,config:pa.value,key:`legend_${ye.value}`,onClickMarker:t[3]||(t[3]=({i:o})=>He(o))},{item:f(({legend:o,index:v})=>[ae("div",{onClick:n=>o.segregate(),style:ee(`opacity:${w.value.includes(v)?.5:1}`)},qe(o.name),13,ll)]),_:1},8,["legendSet","config"])):m(e.$slots,"legend",{key:1,legend:We.value},void 0,!0)],512),e.$slots.watermark?($(),J("div",tl,[m(e.$slots,"watermark",B(X({isPrinting:H(Oe)||H(Re)})),void 0,!0)])):A("",!0),e.$slots.source?($(),J("div",{key:3,ref_key:"source",ref:Me,dir:"auto"},[m(e.$slots,"source",{},void 0,!0)],512)):A("",!0),s.value.end-s.value.start<200?($(),R(qa,{key:4,hideDetails:"",config:{open:u.value.showTable,maxHeight:1e4,body:{backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color},head:{backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color}}},{content:f(()=>[($(),R(Ka,{key:`table_${he.value}`,colNames:re.value.colNames,head:re.value.head,body:re.value.body,config:re.value.config,title:`${a.value.style.chart.title.text}${a.value.style.chart.title.subtitle.text?` : ${a.value.style.chart.title.subtitle.text}`:""}`,onClose:t[4]||(t[4]=o=>u.value.showTable=!1)},{th:f(({th:o})=>[ae("div",{innerHTML:o},null,8,ol)]),td:f(({td:o})=>[Aa(qe(o),1)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):A("",!0),a.value.userOptions.buttons.annotator&&h.value.length?($(),R(Ja,{key:5,parent:Z.value,backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color,active:ie.value,onClose:me},null,8,["parent","backgroundColor","color","active"])):A("",!0)],14,al))}},Ll=el(sl,[["__scopeId","data-v-1359e2b5"]]);export{Ll as default};
