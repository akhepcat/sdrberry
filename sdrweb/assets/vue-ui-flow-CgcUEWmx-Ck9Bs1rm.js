import{z as ze,c as f,b as Se,B as He,C as Be,r as y,D as fe,R as Le,A as J,H as Ge,w as Ve,E as je,a0 as v,G as ge,K as De,V as Ye,N as Re,o as r,a as i,i as A,L as x,j as Je,l as b,m as k,p as U,q as W,u as c,M as N,n as me,J as Ue,f as pe,e as S,P,k as I,ag as ye,h as q,am as We,U as qe,g as Xe}from"./index-DWKgdAH2.js";import{x as Ze}from"./Title-DyD-mBPN-Cd9Bnlgg.js";import{r as Ke,a as Qe}from"./usePrinter-CLcxWv-4-dA-zEbQs.js";import{W as et}from"./DataTable-D8fcY_sJ-B-gWso_F.js";import tt from"./vue-ui-accordion-m8rut1bP-BfpJTYkN.js";import lt from"./vue-ui-skeleton-Dgzcn3FL-QTPCyjXQ.js";import{c as be}from"./useNestedProp-BxrcwmTZ-DuVaLmrv.js";import{p as ot}from"./PackageVersion-mSsg8dpu-BMuAJ9y0.js";import{S as at}from"./PenAndPaper-Dk41ZrJ0-DIRvLwPQ.js";import{s as nt}from"./vue-data-ui-DF7u-eZV-BLQGmUKN.js";import"./Shape-DYFnvMNd-vb9KMPt_.js";const st=["id"],ut={key:1,ref:"noTitle",class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},rt={key:2,style:"width:100%;background:transparent;padding-bottom:24px"},it=["xmlns","viewBox"],ct=["id"],vt=["stop-color"],dt=["stop-color"],ht=["d","fill","stroke","stroke-width"],ft=["x","y","height","width","fill","stroke","stroke-width","onMouseenter"],gt=["x","y","font-size","fill"],mt=["x","y","font-size","fill"],pt={key:4,class:"vue-data-ui-watermark"},yt={key:6,ref:"source",dir:"auto"},bt=["innerHTML"],kt={__name:"vue-ui-flow",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},setup(ke,{expose:we}){const m=ke,{vue_ui_flow:xe}=ze(),H=f(()=>!!m.dataset&&m.dataset.length);Se(()=>{X()});function X(){He(m.dataset)&&Be({componentName:"VueUiFlow",type:"dataset"})}const B=y(fe()),L=y(null),Z=y(0),K=y(0),_=y(!1);function $e(t){_.value=t,Z.value+=1}const e=f({get:()=>Q(),set:t=>t});function Q(){const t=be({userConfig:m.config,defaultConfig:xe});return t.theme?{...be({userConfig:Ge.vue_ui_flow[t.theme]||m.config,defaultConfig:t}),customPalette:Le[t.theme]||J}:t}Ve(()=>m.config,t=>{e.value=Q(),X(),K.value+=1},{deep:!0});const{isPrinting:ee,isImaging:te,generatePdf:le,generateImage:oe}=Ke({elementId:`flow_${B.value}`,fileName:e.value.style.chart.title.text||"vue-ui-flow"}),Ce=f(()=>e.value.userOptions.show&&!e.value.style.chart.title.text),G=f(()=>je(e.value.customPalette)),ae=f(()=>e.value.style.chart.nodes.gap),C=f(()=>e.value.style.chart.nodes.width),F=y({showTable:e.value.table.show}),ne=f(()=>e.value.style.chart.links.width),V=f(()=>!m.dataset||!m.dataset.length?[]:m.dataset.map(t=>[t[0],t[1],v(t[2])])),se=f(()=>{const t={};function o(a){t[a]||(t[a]={inflow:0,outflow:0})}V.value.forEach(([a,s,g])=>{o(a),o(s),t[a].outflow+=g,t[s].inflow+=g});let l=0;for(const a in t){const s=Math.max(t[a].inflow,t[a].outflow);l=Math.max(l,s)}return l});function Te(t){return t/se.value*100+e.value.style.chart.nodes.minHeight}function Ne(t){const o=e.value.style.chart.nodes.minHeight;return(t-o)/100*se.value}function _e(t){const o={},l={};function a(n,u){o[n]||(o[n]={height:0,level:null,inflow:0,outflow:0}),o[n].level===null&&(o[n].level=u),l[u]||(l[u]=[]),l[u].includes(n)||l[u].push(n)}t.forEach(([n,u,h],T)=>{const $=o[n]?o[n].level:0,z=$+1;a(n,$),a(u,z),o[n].children||(o[n].children=[]),o[n].children.push({target:u,value:h}),o[n].outflow+=h,o[u].inflow+=h}),Object.keys(o).forEach((n,u)=>{o[n].color=G.value[u]||G.value[u%G.value.length]||J[u]||J[u%d.length]});for(const n in o)o[n].height=Te(Math.max(o[n].inflow,o[n].outflow)),o[n].name=n;const s={};for(const n in l){let u=0;l[n].forEach((h,T)=>{const $=o[h].height;s[h]={x:parseInt(n,10)*ne.value+e.value.style.chart.padding.left,y:u,absoluteY:u,height:$,i:T,color:o[h].color,value:Ne($)},u+=$+ae.value})}const g=[];for(const n in o){let u=s[n].absoluteY;o[n].children&&o[n].children.forEach(({target:h,value:T},$)=>{const z=s[h].y,Y=s[n],R=s[h],ce=v(u),ve=v(u+T/o[n].outflow*Y.height),de=v(z),he=v(z+T/o[h].inflow*R.height),Me={id:fe(),source:n,target:h,path:`M ${v(Y.x)+v(C.value)} ${ce} L ${v(Y.x)+v(C.value)} ${ve} L ${v(R.x)} ${he} L ${v(R.x)} ${de} Z`,value:T,sourceColor:o[n].color,targetColor:o[h].color};g.push(Me),u+=ve-ce,s[h].y+=he-de})}return{nodeCoordinates:s,links:g}}const p=f(()=>{const t=_e(m.dataset);return{nodes:Object.keys(t.nodeCoordinates).map((o,l)=>({...t.nodeCoordinates[o],name:o})),links:t.links}}),Ae=f(()=>Pe(p.value.nodes));function Pe(t){const o={};for(const l in t){const{x:a,height:s}=t[l];o[a]||(o[a]=0),o[a]+=s+ae.value}return Math.max(...Object.values(o))}const j=f(()=>{const{top:t,right:o,left:l,bottom:a}=e.value.style.chart.padding,s=V.value.length*ne.value;return{height:Ae.value+t+a,width:o+Math.max(...p.value.nodes.map(g=>g.x))+C.value,left:l,top:t,right:s-o,p_top:t,p_bottom:a}});function Ie(t){const o={},l={},a=new Set;return V.value.forEach(([s,g,n])=>{o[s]||(o[s]=[]),l[g]||(l[g]=[]),o[s].push(g),l[g].push(s)}),o[t]&&o[t].forEach(s=>a.add(s)),l[t]&&l[t].forEach(s=>a.add(s)),Array.from(a).concat(t)}const w=y(null),O=y(null);function Fe(t){w.value=Ie(t.name),O.value=t.name}function Oe(){w.value=null,O.value=null}const ue=f(()=>p.value.links.map(({source:t,target:o,sourceColor:l,targetColor:a,value:s})=>({source:t,target:o,sourceColor:l,targetColor:a,value:s})));function re(){De(()=>{const t=ue.value.map((a,s)=>[[a.source],[a.target],[a.value]]),o=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[e.value.table.columnNames.source],[e.value.table.columnNames.target],[e.value.table.columnNames.value]]].concat(t),l=Ye(o);Re({csvContent:l,title:e.value.style.chart.title.text||"vue-ui-flow"})})}const E=f(()=>{const t=[e.value.table.columnNames.source,e.value.table.columnNames.target,e.value.table.columnNames.value],o=ue.value.map((a,s)=>[{color:a.sourceColor,name:a.source},{color:a.targetColor,name:a.target},ge({p:e.value.style.chart.nodes.labels.prefix,v:a.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding})]),l={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint};return{colNames:[e.value.table.columnNames.source,e.value.table.columnNames.target,e.value.table.columnNames.value],head:t,body:o,config:l}});function Ee(){return p.value}function ie(){F.value.showTable=!F.value.showTable}const M=y(!1);function D(){M.value=!M.value}return we({getData:Ee,generateCsv:re,generateImage:oe,generatePdf:le,toggleTable:ie,toggleAnnotator:D}),(t,o)=>(r(),i("div",{ref_key:"flowChart",ref:L,class:me(`vue-ui-flow ${_.value?"vue-data-ui-wrapper-fullscreen":""}`),style:N(`font-family:${e.value.style.fontFamily};width:100%; text-align:center;background:${e.value.style.chart.backgroundColor}`),id:`flow_${B.value}`},[e.value.userOptions.buttons.annotator?(r(),A(at,{key:0,parent:L.value,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,active:M.value,onClose:D},null,8,["parent","backgroundColor","color","active"])):x("",!0),Ce.value?(r(),i("div",ut,null,512)):x("",!0),e.value.style.chart.title.text?(r(),i("div",rt,[(r(),A(Ze,{key:`title_${K.value}`,config:{title:{cy:"flow-title",...e.value.style.chart.title},subtitle:{cy:"flow-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))])):x("",!0),e.value.userOptions.show&&H.value?(r(),A(Qe,{ref:"details",key:`user_option_${Z.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:c(ee),isImaging:c(te),uid:B.value,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isFullscreen:_.value,titles:{...e.value.userOptions.buttonTitles},chartElement:L.value,position:e.value.userOptions.position,hasAnnotator:e.value.userOptions.buttons.annotator,isAnnotation:M.value,onToggleFullscreen:$e,onGeneratePdf:c(le),onGenerateCsv:re,onGenerateImage:c(oe),onToggleTable:ie,onToggleAnnotator:D},Je({_:2},[t.$slots.optionPdf?{name:"optionPdf",fn:b(()=>[k(t.$slots,"optionPdf",{},void 0,!0)]),key:"0"}:void 0,t.$slots.optionCsv?{name:"optionCsv",fn:b(()=>[k(t.$slots,"optionCsv",{},void 0,!0)]),key:"1"}:void 0,t.$slots.optionImg?{name:"optionImg",fn:b(()=>[k(t.$slots,"optionImg",{},void 0,!0)]),key:"2"}:void 0,t.$slots.optionTable?{name:"optionTable",fn:b(()=>[k(t.$slots,"optionTable",{},void 0,!0)]),key:"3"}:void 0,t.$slots.optionFullscreen?{name:"optionFullscreen",fn:b(({toggleFullscreen:l,isFullscreen:a})=>[k(t.$slots,"optionFullscreen",U(W({toggleFullscreen:l,isFullscreen:a})),void 0,!0)]),key:"4"}:void 0,t.$slots.optionAnnotator?{name:"optionAnnotator",fn:b(({toggleAnnotator:l,isAnnotator:a})=>[k(t.$slots,"optionAnnotator",U(W({toggleAnnotator:l,isAnnotator:a})),void 0,!0)]),key:"5"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasPdf","hasXls","hasImg","hasTable","hasFullscreen","isFullscreen","titles","chartElement","position","hasAnnotator","isAnnotation","onGeneratePdf","onGenerateImage"])):x("",!0),(r(),i("svg",{xmlns:c(Ue),viewBox:`0 0 ${j.value.width} ${j.value.height}`,class:me({"vue-data-ui-fullscreen--on":_.value,"vue-data-ui-fulscreen--off":!_.value}),style:N(`max-width:100%; overflow: visible; background:transparent;color:${e.value.style.chart.color}`)},[pe(ot),S("defs",null,[(r(!0),i(P,null,I(p.value.links,(l,a)=>(r(),i("linearGradient",{id:l.id,x1:"0%",y1:"0%",x2:"100%",y2:"0%"},[S("stop",{offset:"0%","stop-color":l.sourceColor},null,8,vt),S("stop",{offset:"100%","stop-color":l.targetColor},null,8,dt)],8,ct))),256))]),(r(!0),i(P,null,I(p.value.links,l=>(r(),i("path",{class:"vue-ui-flow-link",d:l.path,fill:`url(#${l.id})`,stroke:e.value.style.chart.links.stroke,"stroke-width":e.value.style.chart.links.strokeWidth,style:N(`opacity:${O.value?[l.target,l.source].includes(O.value)?1:.3:e.value.style.chart.links.opacity}`)},null,12,ht))),256)),(r(!0),i(P,null,I(p.value.nodes,(l,a)=>(r(),i("rect",{class:"vue-ui-flow-node",x:l.x,y:c(v)(l.absoluteY),height:c(v)(l.height),width:C.value,fill:l.color,stroke:e.value.style.chart.nodes.stroke,"stroke-width":e.value.style.chart.nodes.strokeWidth,onMouseenter:s=>Fe(l),onMouseleave:o[0]||(o[0]=s=>Oe()),style:N(`opacity:${w.value?w.value.includes(l.name)?1:.2:1}`)},null,44,ft))),256)),(r(!0),i(P,null,I(p.value.nodes,(l,a)=>(r(),i("text",{x:l.x+C.value/2,y:c(v)(l.absoluteY+l.height/2-e.value.style.chart.nodes.labels.fontSize/4),"font-size":e.value.style.chart.nodes.labels.fontSize,fill:c(ye)(l.color),"text-anchor":"middle",style:N(`pointer-events: none; opacity:${w.value?w.value.includes(l.name)?1:0:1}`)},q(e.value.style.chart.nodes.labels.abbreviation.use?c(We)({source:l.name,length:e.value.style.chart.nodes.labels.abbreviation.length}):l.name),13,gt))),256)),(r(!0),i(P,null,I(p.value.nodes,(l,a)=>(r(),i("text",{x:l.x+C.value/2,y:c(v)(l.absoluteY+l.height/2+e.value.style.chart.nodes.labels.fontSize),"font-size":e.value.style.chart.nodes.labels.fontSize,fill:c(ye)(l.color),"text-anchor":"middle",style:N(`pointer-events: none; opacity:${w.value?w.value.includes(l.name)?1:0:1}`)},q(c(qe)(e.value.style.chart.nodes.labels.formatter,l.value,c(ge)({p:e.value.style.chart.nodes.labels.prefix,v:l.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding}),{datapoint:l,seriesIndex:a})),13,mt))),256)),k(t.$slots,"svg",{svg:j.value},void 0,!0)],14,it)),t.$slots.watermark?(r(),i("div",pt,[k(t.$slots,"watermark",U(W({isPrinting:c(ee)||c(te)})),void 0,!0)])):x("",!0),H.value?x("",!0):(r(),A(lt,{key:5,config:{type:"flow",style:{backgroundColor:e.value.style.chart.backgroundColor}}},null,8,["config"])),t.$slots.source?(r(),i("div",yt,[k(t.$slots,"source",{},void 0,!0)],512)):x("",!0),H.value?(r(),A(tt,{key:7,hideDetails:"",config:{open:F.value.showTable,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:b(()=>[pe(et,{colNames:E.value.colNames,head:E.value.head,body:E.value.body,config:E.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:o[1]||(o[1]=l=>F.value.showTable=!1)},{th:b(({th:l})=>[S("div",{innerHTML:l,style:{display:"flex","align-items":"center"}},null,8,bt)]),td:b(({td:l})=>[Xe(q(l.name||l),1)]),_:1},8,["colNames","head","body","config","title"])]),_:1},8,["config"])):x("",!0)],14,st))}},Ot=nt(kt,[["__scopeId","data-v-49421974"]]);export{Ot as default};
